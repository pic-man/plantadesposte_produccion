<?php
//session_start();

use Pdo\Mysql;

error_reporting(0);
date_default_timezone_set("America/bogota");

function listaResponsablesCompleta($inicio, $fin, $busqueda) {
    include('../config.php');
    $sql = "SELECT `cedula`,`nombres`,`telefono`,`status`,`id` FROM `responsables` WHERE tipo<>0";

    if (!empty($busqueda)) {
        $sql .= " WHERE nombres LIKE '%$busqueda%'";
    }

    $sql .= " ORDER BY id DESC";

    $sql .= " LIMIT $inicio, $fin";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        /* echo "Error al ejecutar la consulta 1: " . mysqli_error($link); */
        echo $sql;
        exit();
    } else {
        return $rs_operacion;
    }
}
function listaConductoresCompleta($inicio, $fin, $busqueda)
{
    include('../config.php');
    $sql = "SELECT `cedula`,`nombres`,`telefono`,`status`,`id` FROM `conductores`";

    if (!empty($busqueda)) {
        $sql .= " WHERE nombres LIKE '%$busqueda%'";
    }

    $sql .= " ORDER BY id DESC";

    $sql .= " LIMIT $inicio, $fin";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        /* echo $sql; */
        exit();
    } else {
        return $rs_operacion;
    }
}

function listaPlacasCompleta($inicio, $fin, $busqueda)
{
    include('../config.php');
    $sql = "SELECT `placa`,`status`,`id` FROM `placas`";

    if (!empty($busqueda)) {
        $sql .= " WHERE placa LIKE '%$busqueda%'";
    }

    $sql .= " ORDER BY id DESC";

    $sql .= " LIMIT $inicio, $fin";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        /* echo "Error al ejecutar la consulta 1: " . mysqli_error($link); */
        echo $sql;
        exit();
    } else {
        return $rs_operacion;
    }
}

function listaResponsables()
{
    include('config.php');
    $sql = "SELECT cedula,nombres FROM responsables where status='ACTIVO'";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function listaTipos()
{
    include('config.php');
    $sql = "SELECT id,descripcion FROM tipo where status='ACTIVO'";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function listaMunicipios()
{
    include('config.php');
    $sql = "SELECT descripcion FROM municipios ORDER BY descripcion ASC";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function listaCategorias()
{
    include('config.php');
    $sql = "SELECT id,descripcion FROM categoria where status='ACTIVO'";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function listaSubCategorias()
{
    include('config.php');
    $sql = "SELECT id,descripcion FROM categoriadestino where status='ACTIVO'";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function listaConductores()
{
    include('config.php');

    $sql = "SELECT cedula,nombres FROM conductores order by nombres asc";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function listaConductores_recepcion()
{
    include('config.php');
    $sql = "SELECT cedula, nombres FROM conductores_recepcion ORDER BY nombres asc";
    $rs_operacion = mysqli_query($link, $sql);
    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function listaConductores_recepcion_pollo()
{
    include('config.php');
    $sql = "SELECT cedula, nombres FROM conductores_recepcion_pollo ORDER BY nombres asc";
    $rs_operacion = mysqli_query($link, $sql);
    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function listaConductores_recepcion_registro()
{
    include('../config.php');
    $sql = "SELECT empresa,cedula,nombres FROM conductores_recepcion";
    $rs_operacion = mysqli_query($link, $sql);
    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function listaConductores_recepcion_registro_pollo()
{
    include('../config.php');
    $sql = "SELECT empresa,cedula,nombres FROM conductores_recepcion_pollo";
    $rs_operacion = mysqli_query($link, $sql);
    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function listaPlacas()
{
    include('config.php');

    $sql = "SELECT placa FROM placas order by placa asc";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function listaPlacas_recepcion()
{
    include('config.php');
    $sql = "SELECT placa FROM placas_recepcion ORDER BY placa ASC";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function listaPlacas_recepcion_pollo()
{
    include('config.php');
    $sql = "SELECT placa FROM placas_recepcion_pollo ORDER BY placa ASC";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function listaPlacas_recepcion_registro()
{
    include('../config.php');
    $sql = "SELECT placa FROM placas_recepcion";
    $rs_operacion = mysqli_query($link, $sql);
    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 2: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function listaPlacas_recepcion_registro_pollo()
{
    include('../config.php');
    $sql = "SELECT placa FROM placas_recepcion_pollo";
    $rs_operacion = mysqli_query($link, $sql);
    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 2: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function listaDestinos()
{
    include('config.php');
    $sql = "SELECT id,empresa,sede FROM destinos WHERE status = 'ACTIVO'";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}
function listaOrigen()
{
    include('config.php');
    $sql = "SELECT id,nit,sede FROM beneficio";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function listaProveedores()
{
    include('config.php');
    $sql = "SELECT id,nit,sede FROM proveedorpollo";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function listaProveedoresCCompleta()
{
    include('../config.php');

    $sql = "SELECT codigog,
                   fechaexp,
                   responsables.nombres as responsable,
                   destinos.sede as sede,
                   conductores.nombres as conductor,
                   placa,
                   guias.tipo,
                   id_guia,
                   consecutivog,
                   destinos.empresa as empresa,
                   guias.status
                FROM guias
                INNER JOIN 
                    responsables ON guias.responsable = responsables.cedula
                INNER JOIN 
                    destinos ON guias.destino = destinos.id
                INNER JOIN 
                    conductores ON guias.conductor = conductores.cedula
                WHERE
                    guias.tipo <> 'POLLO'";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}
function listaProveedoresPCompleta()
{
    include('../config.php');

    $sql = "SELECT codigog,
                   fechaexp,
                   responsables.nombres as responsable,
                   destinos.sede as sede,
                   conductores.nombres as conductor,
                   placa,
                   guiaspollo.tipo,
                   id_guia,
                   consecutivog,
                   destinos.empresa as empresa,
                   guiaspollo.status,
                   canales
            FROM guiaspollo
            INNER JOIN 
                    responsables ON guiaspollo.responsable = responsables.cedula
            INNER JOIN 
                    destinos ON guiaspollo.destino = destinos.id
            INNER JOIN 
                    conductores ON guiaspollo.conductor = conductores.cedula";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}

function listaRecepcionesCompleta()
{
    include('../config.php');

    $sql = "SELECT id_recepcion,
                   fecharec,
                   remision,
                   beneficio.sede as sedeb,
                   destinos.sede as sede,
                   canales,
                   consecutivog,
                   fechasac,
                   tipo,
                   recepcion.status
                FROM recepcion
                INNER JOIN 
                    beneficio ON recepcion.beneficio = beneficio.id
                INNER JOIN 
                    destinos ON recepcion.destino = destinos.id";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}
function listaRecepcionesPaginada($inicio, $fin, $busqueda)
{
    include('../config.php');

    $sql = "SELECT id_recepcion,
    fecharec,
    remision,
    beneficio.sede as sedeb,
    destinos.sede as sede,
    canales,
    consecutivog,
    fechasac,
    tipo,
    recepcion.status
 FROM recepcion
 INNER JOIN 
     beneficio ON recepcion.beneficio = beneficio.id
 INNER JOIN 
     destinos ON recepcion.destino = destinos.id";

    if (!empty($busqueda)) {
        $sql .= " WHERE (fecharec LIKE '%$busqueda%'";
        $sql .= " OR fechasac LIKE '%$busqueda%'";
        $sql .= " OR destinos.sede LIKE '%$busqueda%'";
        $sql .= " OR remision LIKE '%$busqueda%'";
        $sql .= " OR canales LIKE '%$busqueda%'";
        $sql .= " OR tipo LIKE '%$busqueda%'";
        $sql .= " OR placa LIKE '%$busqueda%')";
    }

    $sql .= " ORDER BY id_recepcion DESC";

    $sql .= " LIMIT $inicio, $fin";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}
/*function listaProveedoresConFiltro($busqueda)
{   include('../config.php');

        $sql = "SELECT nit,razon_social,telefono FROM proveedores";

        if (!empty($busqueda)) {
            $sql .= " WHERE razon_social LIKE '%$busqueda%'";
        }
        $sql .= " ORDER BY razon_social ASC";
    
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
      }
    else{
        return $rs_operacion;
    }  
}
*/

function cargarGuiaRecepcion($idRecepcion)
{
    include('../config.php');

    $sql = "SELECT fecharec,
                   fechasac,
                   tipo,
                   remision,
                   beneficio,
                   destino,
                   canales,
                   recibo,
                   consecutivog,
                   fechasac,
                   tipo,
                   status,
                   responsable,
                   conductor,
                   placa,
                   lotep,
                   ica,
                   guiat,
                   certificadoc,
                   cph1,
                   cph2,
                   cph3,
                   cph4,
                   cph5,
                   chv1,
                   chv2,
                   chv3,
                   chv4,
                   ccoh1,
                   ccoh2,
                   ccoh3,
                   ccoh4,
                   ccoh5,
                   ccoh6,
                   ccoh7,
                   ccoh8,
                   ccoh9,
                   ccoh10,
                   observaciones
                FROM recepcion
                WHERE
                    id_recepcion=" . $idRecepcion . "";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}
function cargarGuiaRecepcionPollo($idRecepcion)
{
    include('../config.php');

    $sql = "SELECT fecharec,
                   fechasac,
                   tipo,
                   beneficio,
                   destino,
                   canales,
                   consecutivog,
                   especie,
                   tipo,
                   status,
                   responsable,
                   conductor,
                   placa,
                   guiat,
                   certificadoc,
                   cph1,
                   cph2,
                   cph3,
                   cph4,
                   cph5,
                   chv1,
                   chv2,
                   chv3,
                   chv4,
                   chv5,
                   chv6,
                   ccoh1,
                   ccoh2,
                   ccoh3,
                   ccoh4,
                   ccoh5,
                   ccoh6,
                   ccoh7,
                   ccoh8,
                   ccoh9,
                   ccoh10,
                   observaciones,
                   lote_planta
                FROM recepcionpollo
                WHERE
                    id_recepcion=" . $idRecepcion . "";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}
function cargarDatos()
{
    include('../config.php');

    $sql = "SELECT id_recepcion,
                   fecharec,
                   fechasac,
                   tipo,
                   remision,
                   beneficio,
                   destino,
                   canales,
                   recibo,
                   consecutivog,
                   fechasac,
                   tipo,
                   status,
                   responsable,
                   conductor,
                   placa,
                   lotep,
                   ica,
                   guiat,
                   certificadoc,
                   cph1,
                   cph2,
                   cph3,
                   cph4,
                   cph5,
                   chv1,
                   chv2,
                   chv3,
                   chv4,
                   ccoh1,
                   ccoh2,
                   ccoh3,
                   ccoh4,
                   ccoh5,
                   ccoh6,
                   ccoh7,
                   ccoh8,
                   ccoh9,
                   ccoh10,
                   observaciones
                FROM recepcion
                ORDER BY id_recepcion DESC
                LIMIT 1";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function cargarGuia($idGuia)
{
    include('../config.php');
    $sql = "SELECT codigog,
        fechaexp,
        responsable,
        destino,
        conductor,
        placa,
        tipo,
        id_guia,
        consecutivog,
        canales,
        observaciones,
        precinto
    FROM 
        guias
    INNER JOIN 
        destinos ON guias.destino = destinos.id
    INNER JOIN 
        conductores ON guias.conductor = conductores.cedula
    WHERE
        id_guia=" . $idGuia;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function cargarGuiaP($idGuia)
{
    include('../config.php');
    $sql = "SELECT codigog,
        fechaexp,
        responsable,
        destino,
        conductor,
        placa,
        tipo,
        id_guia,
        consecutivog,
        canales,
        observaciones,
        precinto
    FROM 
        guiaspollo
    INNER JOIN 
        destinos ON guiaspollo.destino = destinos.id
    INNER JOIN 
        conductores ON guiaspollo.conductor = conductores.cedula
    WHERE
        id_guia=" . $idGuia;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function cargarResponsable($idResp)
{
    include('../config.php');
    $sql = "SELECT cedula,
        nombres,
        telefono,
        status
    FROM 
        responsables
    WHERE
        id=" . $idResp;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function cargarConductor($idCond)
{
    include('../config.php');
    $sql = "SELECT cedula,
        nombres,
        telefono,
        status
    FROM 
        conductores
    WHERE
        id=" . $idCond;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function cargarItem($idItem)
{
    include('../config.php');
    $sql = "SELECT item,
        descripcion,
        codigo,
        tipo,
        categoria,
        categoriadestino,
        status,
        id
    FROM 
        plantilla
    WHERE
        id=" . $idItem;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function cargarResponsables($idResponsables)
{
    include('../config.php');
    $sql = "SELECT cedula,
        nombres,
        telefono,
        status,
        id
    FROM 
        responsables
    WHERE
        id=" . $idResponsables;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function cargarPlanta($idResponsables)
{
    include('../config.php');
    $sql = "SELECT nit,
        sede,
        direccion,
        municipio,
        status,
        id
    FROM 
        beneficio
    WHERE
        id=" . $idResponsables;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function cargarProveedor($idPlanta)
{
    include('../config.php');
    $sql = "SELECT nit,
        sede,
        direccion,
        municipio,
        polloporcanastillas,
        status,
        id,
        siglas
    FROM 
        proveedorpollo
    WHERE
        id=" . $idPlanta;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function cargarPlacasD($idPlacasD)
{
    include('../config.php');
    $sql = "SELECT placa,
        status,
        id
    FROM 
        placas
    WHERE
        id=" . $idPlacasD;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function cargarConductores($idResponsables)
{
    include('../config.php');
    $sql = "SELECT cedula,
        nombres,
        telefono,
        status,
        id
    FROM 
        conductores
    WHERE
        id=" . $idResponsables;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function cargarCriterio($idcriterio)
{
    include('../config.php');
    $sql = "SELECT id_item_proveedor,
        plantilla.descripcion as item,
        proveedor,
        lote,
        temperatura,
        unidades,
        cajas,
        peso
    FROM 
        item_proveedor
    INNER JOIN 
        plantilla ON plantilla.item = item_proveedor.item    
    WHERE
        id_item_proveedor=" . $idcriterio;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function cargarCriterioP($idcriterio)
{
    include('../config.php');
    $sql = "SELECT id_item_proveedor,
        plantilla.descripcion as item,
        proveedor,
        lote,
        temperatura,
        unidades,
        cajas,
        peso,
        base
    FROM 
        item_proveedorpollo
    INNER JOIN 
        plantilla ON plantilla.item = item_proveedorpollo.item    
    WHERE
        id_item_proveedor=" . $idcriterio;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}
function cargarCriterioRecepcionPollo($idcriterio)
{
    include('../config.php');
    $sql = "SELECT id_item_proveedor,
        plantilla.descripcion as item,
        proveedor,
        temperatura,
        unidades,
        cajas,
        peso,
        base,
        observacion,
        foto
    FROM 
        recepcion_pesos_pollo
    INNER JOIN 
        plantilla ON plantilla.item = recepcion_pesos_pollo.item    
    WHERE
        id_item_proveedor=" . $idcriterio;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}


function cargarCriterioPeso($idcriterio)
{
    include('../config.php');
    $sql = "SELECT id_recepcion_pesos,
        turno,
        estomago1,
        estomago2,
        piernas1,
        piernas2,
        temperatura
    FROM 
        recepcion_pesos
    WHERE
        id_recepcion_pesos=" . $idcriterio;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function editarGuia($info)
{
    include('../config.php');
    $sql = "UPDATE guias set 
              fechaexp = '" . $info['fechaexp'] . "',canales='" . $info['canales'] . "',consecutivog='" . $info['consecutivog'] . "',responsable='" . $info['responsable'] . "',destino = '" . $info['destino'] . "',conductor = '" . $info['conductor'] . "',placa = '" . $info['placa'] . "',tipo = '" . $info['producto'] . "',precinto = '" . $info['precinto'] . "',observaciones='" . $info['observaciones'] . "' where id_guia = " . $info['id_guia'];

    $rs_operacion = mysqli_query($link, $sql);

    $sql2 = "UPDATE item_proveedor set 
              lote = '" . $info['consecutivog'] . "' where proveedor = " . $info['id_guia'];

    $rs_operacion2 = mysqli_query($link, $sql2);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $info['id_guia'];
    }
}

function editarGuiaP($info)
{
    include('../config.php');
    $sql = "UPDATE guiaspollo set 
              fechaexp = '" . $info['fechaexp'] . "',canales='" . $info['canales'] . "',responsable='" . $info['responsable'] . "',destino = '" . $info['destino'] . "',conductor = '" . $info['conductor'] . "',placa = '" . $info['placa'] . "',precinto = '" . $info['precinto'] . "',observaciones='" . $info['observaciones'] . "' where id_guia = " . $info['id_guia'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        //return mysqli_error($link);
        return $sql;
    } else {
        return $info['id_guia'];
    }
}

function editarRecepcion($datosEdit)
{
    include('../config.php');
    $sql = "UPDATE recepcion set 
                fecharec= '" . $datosEdit['fecharec'] . "',
                fechasac= '" . $datosEdit['fechasac'] . "',
                tipo= '" . $datosEdit['tipo'] . "',
                remision= '" . $datosEdit['remision'] . "',
                canales= '" . $datosEdit['canales'] . "',
                recibo='" . $datosEdit['despacho'] . "',
                consecutivog= '" . $datosEdit['consecutivog'] . "',
                responsable= '" . $datosEdit['responsable'] . "',
                beneficio= '" . $datosEdit['beneficio'] . "',
                destino= '" . $datosEdit['destino'] . "',
                conductor= '" . $datosEdit['conductor'] . "',
                placa= '" . $datosEdit['placa'] . "',
                lotep= '" . $datosEdit['lotep'] . "',
                ica= '" . $datosEdit['ica'] . "',
                guiat= '" . $datosEdit['guiat'] . "',
                certificadoc= '" . $datosEdit['certificadoc'] . "',
                cph1= '" . $datosEdit['cph1'] . "',
                cph2= '" . $datosEdit['cph2'] . "',
                cph3= '" . $datosEdit['cph3'] . "',
                cph4= '" . $datosEdit['cph4'] . "',
                cph5= '" . $datosEdit['cph5'] . "',
                chv1= '" . $datosEdit['chv1'] . "',
                chv2= '" . $datosEdit['chv2'] . "',
                chv3= '" . $datosEdit['chv3'] . "',
                chv4= '" . $datosEdit['chv4'] . "',
                ccoh1= '" . $datosEdit['ccoh1'] . "',
                ccoh2= '" . $datosEdit['ccoh2'] . "',
                ccoh3= '" . $datosEdit['ccoh3'] . "',
                ccoh4= '" . $datosEdit['ccoh4'] . "',
                ccoh5= '" . $datosEdit['ccoh5'] . "',
                ccoh6= '" . $datosEdit['ccoh6'] . "',
                ccoh7= '" . $datosEdit['ccoh7'] . "',
                ccoh8= '" . $datosEdit['ccoh8'] . "',
                ccoh9= '" . $datosEdit['ccoh9'] . "',
                ccoh10= '" . $datosEdit['ccoh10'] . "',
                observaciones= '" . $datosEdit['observaciones'] . "'
                where id_recepcion = " . $datosEdit['id_guia'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $info['id_guia'];
    }
}

function editarRecepcionPollo($datosEdit)
{
    include('../config.php');
    $sql = "UPDATE recepcionpollo set 
                fecharec= '" . $datosEdit['fecharec'] . "',
                fechasac= '" . $datosEdit['fechasac'] . "',
                especie= '" . $datosEdit['especie'] . "',
                tipo= '" . $datosEdit['tipo'] . "',
                canales= '" . $datosEdit['canales'] . "',
                consecutivog= '" . $datosEdit['consecutivog'] . "',
                responsable= '" . $datosEdit['responsable'] . "',
                beneficio= '" . $datosEdit['beneficio'] . "',
                destino= '" . $datosEdit['destino'] . "',
                conductor= '" . $datosEdit['conductor'] . "',
                placa= '" . $datosEdit['placa'] . "',
                guiat= '" . $datosEdit['guiat'] . "',
                certificadoc= '" . $datosEdit['certificadoc'] . "',
                cph1= '" . $datosEdit['cph1'] . "',
                cph2= '" . $datosEdit['cph2'] . "',
                cph3= '" . $datosEdit['cph3'] . "',
                cph4= '" . $datosEdit['cph4'] . "',
                cph5= '" . $datosEdit['cph5'] . "',
                chv1= '" . $datosEdit['chv1'] . "',
                chv2= '" . $datosEdit['chv2'] . "',
                chv3= '" . $datosEdit['chv3'] . "',
                chv4= '" . $datosEdit['chv4'] . "',
                chv5= '" . $datosEdit['chv5'] . "',
                chv6= '" . $datosEdit['chv6'] . "',
                ccoh1= '" . $datosEdit['ccoh1'] . "',
                ccoh2= '" . $datosEdit['ccoh2'] . "',
                ccoh3= '" . $datosEdit['ccoh3'] . "',
                ccoh4= '" . $datosEdit['ccoh4'] . "',
                ccoh5= '" . $datosEdit['ccoh5'] . "',
                ccoh6= '" . $datosEdit['ccoh6'] . "',
                ccoh7= '" . $datosEdit['ccoh7'] . "',
                ccoh8= '" . $datosEdit['ccoh8'] . "',
                ccoh9= '" . $datosEdit['ccoh9'] . "',
                ccoh10= '" . $datosEdit['ccoh10'] . "',
                observaciones= '" . $datosEdit['observaciones'] . "',
                lote_planta = '" . $datosEdit['lotePlanta'] . "'
                where id_recepcion = " . $datosEdit['id_guia'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $info['id_guia'];
    }
}

function editarResponsable($info)
{
    include('../config.php');
    $sql = "UPDATE responsables set 
              cedula = '" . $info['cedula'] . "',nombres='" . $info['nombres'] . "',telefono='" . $info['telefono'] . "',status='" . $info['status'] . "' where id = " . $info['id_guia'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $info['id_guia'];
    }
}

function editarPlacasD($info)
{
    include('../config.php');
    $sql = "UPDATE placas set 
              placa = '" . $info['placa'] . "',status='" . $info['status'] . "' where id = " . $info['id'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $info['id'];
    }
}
function editarConductores($info)
{
    include('../config.php');

    $sql = "UPDATE conductores set 
            cedula = '" . $info['cedula'] . "',
            nombres ='" . $info['nombres'] . "',
            telefono='" . $info['telefono'] . "',
            status='" . $info['status'] . "'
            where id = " . $info['id'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        //return mysqli_error($link);
        return $sql;
    } else {
        return $info['id_guia'];
    }
}

function editarItem($info)
{
    include('../config.php');

    $sql = "UPDATE plantilla set 
              item = '" . $info['item'] . "',
              descripcion='" . $info['descripcion'] . "',
              codigo='" . $info['codigo'] . "',
              tipo='" . $info['tipo'] . "',
              categoria='" . $info['categoria'] . "',
              categoriadestino='" . $info['subcategoria'] . "',
              status='" . $info['status'] . "'
              where id = " . $info['id'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $info['id_guia'];
    }
}

function editarResponsables($info)
{
    include('../config.php');

    $clave = md5($info['clave']);

    $sql = "UPDATE responsables set 
              cedula = '" . $info['cedula'] . "',
              nombres ='" . $info['nombres'] . "',
              telefono='" . $info['telefono'] . "',
              clave='" . $clave . "',
              status='" . $info['status'] . "'
              where id = " . $info['id'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        //return mysqli_error($link);
        return $sql;
    } else {
        return $info['id_guia'];
    }
}

function editarPlanta($info)
{
    include('../config.php');

    $sql = "UPDATE beneficio set 
            nit = '" . $info['nit'] . "',
            sede ='" . $info['razon'] . "',
            direccion ='" . $info['direccion'] . "',
            municipio ='" . $info['municipio'] . "',
            status='" . $info['status'] . "'
            where id = " . $info['id'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        //return mysqli_error($link);
        return $sql;
    } else {
        return $info['id_guia'];
    }
}

function editarProveedorPollo($info)
{
    include('../config.php');

    $sql = "UPDATE proveedorpollo set 
            nit = '" . $info['nit'] . "',
            sede ='" . $info['razon'] . "',
            direccion ='" . $info['direccion'] . "',
            municipio ='" . $info['municipio'] . "',
            polloporcanastillas ='" . $info['polloporcanastillas'] . "',
            siglas = '".$info["siglas"]."',
            status='" . $info['status'] . "'
            where id = " . $info['id'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        //return mysqli_error($link);
        return $sql;
    } else {
        return $info['id_guia'];
    }
}

function editarCriterio($infoCriEdit)
{
    include('../config.php');
    $peso_real = $infoCriEdit['peso'] - ($infoCriEdit['cajas'] * 2);
    $sql = "UPDATE item_proveedor set 
              item = '" . $infoCriEdit['item'] . "',lote='" . $infoCriEdit['lote'] . "',temperatura='" . $infoCriEdit['temperatura'] . "',unidades = '" . $infoCriEdit['unidades'] . "',cajas = '" . $infoCriEdit['cajas'] . "',peso = '" . $infoCriEdit['peso'] . "',peso_real = '" . $peso_real . "' where id_item_proveedor = " . $infoCriEdit['id_criterio'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $infoCriEdit['id_criterio'];
    }
}

function editarCriterioP($datos)
{

    include('../config.php');
    $hora = date("Y-m-d H:i:s");
    $peso_base = round($datos['base'] * 1.8);
    if ($datos['item'] != '999999') {
        $peso_real = number_format($datos['peso'] - (($datos['cajas']) * 2) - (($datos['base'] * 1.8)), 2, ",", ".");

        $sql = "UPDATE item_proveedorpollo set 
                       item = '" . $datos['item'] . "',
                       lote='" . $datos['lote'] . "',
                       temperatura='" . $datos['temperatura'] . "',
                       unidades = '" . $datos['unidades'] . "',
                       cajas = '" . $datos['cajas'] . "',
                       peso = '" . $datos['peso'] . "',
                       base = '" . $datos['base'] . "',
                       peso_real = '" . $peso_real . "' 
                       where id_item_proveedor = " . $datos['id_criterio'];

        $rs_operacion = mysqli_query($link, $sql);
    } else {
        $porcentaje_pechugas = 36;
        $porcentaje_muslos = 21;
        $porcentaje_contramuslos = 23;
        $porcentaje_alas = 20;

        $peso_pechugas = ($porcentaje_pechugas / 100) * $datos['peso'];
        $peso_muslos = ($porcentaje_muslos / 100) * $datos['peso'];
        $peso_contramuslos = ($porcentaje_contramuslos / 100) * $datos['peso'];
        $peso_alas = ($porcentaje_alas / 100) * $datos['peso'];
        //alas
        $item = '050514';
        $unidades = $datos['unidades'] * 2;
        $peso = number_format(round($peso_alas), 2, ",", ".");
        $peso_real = number_format($peso - (($datos['cajas'] / 4) * 2) - (($datos['base'] * 1.8) / 4), 2, ",", ".");
        $cajas = $datos['cajas'] / 4;

        $sql = "UPDATE item_proveedorpollo set 
                       item = '" . $datos['item'] . "',
                       lote='" . $datos['lote'] . "',
                       temperatura='" . $datos['temperatura'] . "',
                       unidades = '" . $datos['unidades'] . "',
                       cajas = '" . $datos['cajas'] . "',
                       peso = '" . $datos['peso'] . "',
                       base = '" . $datos['base'] . "',
                       peso_real = '" . $peso_real . "' 
                       where id_item_proveedor = " . $datos['id_criterio'];

        $rs_operacion = mysqli_query($link, $sql);
        //muslo
        $item = '050516';
        $unidades = $datos['unidades'] * 2;
        $peso = number_format(round($peso_muslos), 2, ",", ".");
        $peso_real = number_format($peso - (($datos['cajas'] / 4) * 2) - (($datos['base'] * 1.8) / 4), 2, ",", ".");
        $cajas = $datos['cajas'] / 4;

        $sql = "UPDATE item_proveedorpollo set 
                       item = '" . $datos['item'] . "',
                       lote='" . $datos['lote'] . "',
                       temperatura='" . $datos['temperatura'] . "',
                       unidades = '" . $datos['unidades'] . "',
                       cajas = '" . $datos['cajas'] . "',
                       peso = '" . $datos['peso'] . "',
                       base = '" . $datos['base'] . "',
                       peso_real = '" . $peso_real . "' 
                       where id_item_proveedor = " . $datos['id_criterio'];

        $rs_operacion = mysqli_query($link, $sql);
        //contra
        $item = '050515';
        $unidades = $datos['unidades'] * 2;
        $peso = number_format(round($peso_contramuslos), 2, ",", ".");
        $peso_real = number_format($peso - (($datos['cajas'] / 4) * 2) - (($datos['base'] * 1.8) / 4), 2, ",", ".");
        $cajas = $datos['cajas'] / 4;

        $sql = "UPDATE item_proveedorpollo set 
                       item = '" . $datos['item'] . "',
                       lote='" . $datos['lote'] . "',
                       temperatura='" . $datos['temperatura'] . "',
                       unidades = '" . $datos['unidades'] . "',
                       cajas = '" . $datos['cajas'] . "',
                       peso = '" . $datos['peso'] . "',
                       base = '" . $datos['base'] . "',
                       peso_real = '" . $peso_real . "' 
                       where id_item_proveedor = " . $datos['id_criterio'];

        $rs_operacion = mysqli_query($link, $sql);
        //pechuga
        $item = '050517';
        $unidades = $datos['unidades'] * 2;
        $peso = number_format(round($peso_pechugas), 2, ",", ".");
        $peso_real = number_format($peso - (($datos['cajas'] / 4) * 2) - (($datos['base'] * 1.8) / 4), 2, ",", ".");
        $cajas = $datos['cajas'] / 4;

        $sql = "UPDATE item_proveedorpollo set 
                       item = '" . $datos['item'] . "',
                       lote='" . $datos['lote'] . "',
                       temperatura='" . $datos['temperatura'] . "',
                       unidades = '" . $datos['unidades'] . "',
                       cajas = '" . $datos['cajas'] . "',
                       peso = '" . $datos['peso'] . "',
                       base = '" . $datos['base'] . "',
                       peso_real = '" . $peso_real . "' 
                       where id_item_proveedor = " . $datos['id_criterio'];

        $rs_operacion = mysqli_query($link, $sql);
    }
    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return mysqli_insert_id($link);
    }
}

function infoCriEditPolloR($datos)
{

    include('../config.php');
    $hora = date("Y-m-d H:i:s");
    $peso_base = round($datos['base'] * 1.8);
    //$peso_real = number_format($datos['peso'] - (($datos['cajas']) * 2) - (($datos['base'] * 1.8)), 2, ",", ".");
    $peso_real = number_format($datos['peso'] - (($datos['cajas']) * $datos['pesocanastilla']) - (($datos['base'] * 1.8)), 2, ",", ".");
    /* item = '" . $datos['item'] . "', */
    $sql = "UPDATE recepcion_pesos_pollo set 
                       temperatura='" . $datos['temperatura'] . "',
                       unidades = '" . $datos['unidades'] . "',
                       cajas = '" . $datos['cajas'] . "',
                       peso = '" . $datos['peso'] . "',
                       base = '" . $datos['base'] . "',
                       peso_real = '" . $peso_real . "',
                       observacion = '".$datos["observacion"]."',
                       foto = '".$datos["fotoForm"]."'
                       where id_item_proveedor = " . $datos['id_criterio'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        echo $sql;
        exit();
    } else {
        return mysqli_insert_id($link);
    }
}

function editarCriterioPeso($infoCriEdit)
{
    include('../config.php');
    $peso_real = $infoCriEdit['peso'] - ($infoCriEdit['cajas'] * 2);
    $sql = "UPDATE recepcion_pesos set 
              estomago1 = '" . $infoCriEdit['estomago1Edicion'] . "',
              estomago2 = '" . $infoCriEdit['estomago2Edicion'] . "',
              piernas1 = '" . $infoCriEdit['pierna1Edicion'] . "',
              piernas2 = '" . $infoCriEdit['pierna2Edicion'] . "',
              temperatura='" . $infoCriEdit['temperaturaEdicion'] . "'
              where id_recepcion_pesos = " . $infoCriEdit['id_recepcion_pesos'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $infoCriEdit['id_criterio'];
    }
}
function guardarTiempoRecepcionPollo($datos)
{
    include('../config.php');
    $hora = date("H:i:s");
    $sql = "UPDATE hora_temporal set 
              hora_recepcion_pollo = '" . $hora . "'
              where id = " . $datos;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $hora;
    }
}

function guardarTiempoRecepcionRes($datos)
{
    include('../config.php');
    $hora = date("H:i:s");
    $sql = "UPDATE hora_temporal set 
              hora_recepcion_carne = '" . $hora . "'
              where id = " . $datos;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $hora;
    }
}

function guardarTiempoDespachoRes($datos)
{
    include('../config.php');
    $hora = date("H:i:s");
    $sql = "UPDATE hora_temporal set 
              hora_despacho_carne = '" . $hora . "'
              where id = " . $datos;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $hora;
    }
}

function guardarTiempoDespachoPollo($datos)
{
    include('../config.php');
    $hora = date("H:i:s");
    $sql = "UPDATE hora_temporal set 
              hora_despacho_pollo = '" . $hora . "'
              where id = " . $datos;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $hora;
    }
}
function editarCriterioPesoCerdo($infoCriEdit)
{
    include('../config.php');
    $peso_real = $infoCriEdit['peso'] - ($infoCriEdit['cajas'] * 2);
    $sql = "UPDATE recepcion_pesos set 
              estomago1 = '" . $infoCriEdit['peso'] . "',
              temperatura='" . $infoCriEdit['temperaturap'] . "',
              observacion ='" . $infoCriEdit['observacion'] . "'
              where id_recepcion_pesos = " . $infoCriEdit['id_recepcion_pesos'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $infoCriEdit['id_criterio'];
    }
}

function bloquearGuia($idBloquear)
{
    include('../config.php');
    $sql = "UPDATE guias set status = '2' where id_guia = " . $idBloquear;
    $rs_operacion = mysqli_query($link, $sql);

    $sql = "UPDATE item_proveedor set status = '2' where proveedor = " . $idBloquear;
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $idBloquear;
    }
}

function bloquearGuiaP($idBloquear)
{
    include('../config.php');
    $sql = "UPDATE guiaspollo set status = '2' where id_guia = " . $idBloquear;
    $rs_operacion = mysqli_query($link, $sql);

    $sql = "UPDATE item_proveedorpollo set status = '2' where proveedor = " . $idBloquear;
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $idBloquear;
    }
}

function bloquearGuiaR($idBloquear)
{
    include('../config.php');
    $sql = "UPDATE recepcion set status = '2' where id_recepcion = " . $idBloquear;
    $rs_operacion = mysqli_query($link, $sql);

    $sql = "UPDATE recepcion_pesos set status = '2' where id_recepcion = " . $idBloquear;
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $idBloquear;
    }
}
function bloquearGuiaRecepcionPollo($idBloquear)
{
    include('../config.php');
    $hora = date("H:i:s");
    $sql = "UPDATE recepcionpollo set status = '2' where id_recepcion = " . $idBloquear;
    $rs_operacion = mysqli_query($link, $sql);

    $sql = "UPDATE recepcion_pesos_pollo set status = '2' where id_recepcion = " . $idBloquear;
    $rs_operacion = mysqli_query($link, $sql);

    $sql = "UPDATE recepcionpollo set hora_final= '" . $hora . "' where id_recepcion = " . $idBloquear;
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return $sql;
    } else {
        return $idBloquear;
    }
}
function desbloquearGuia($idBloquear)
{
    include('../config.php');
    $sql = "UPDATE guias set status = '1' where id_guia = " . $idBloquear;
    $rs_operacion = mysqli_query($link, $sql);

    $sql = "UPDATE item_proveedor set status = '1' where proveedor = " . $idBloquear;
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $idBloquear;
    }
}

function desbloquearGuiaP($idBloquear)
{
    include('../config.php');
    $sql = "UPDATE guiaspollo set status = '1' where id_guia = " . $idBloquear;
    $rs_operacion = mysqli_query($link, $sql);

    $sql = "UPDATE item_proveedorpollo set status = '1' where proveedor = " . $idBloquear;
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $idBloquear;
    }
}

function desbloquearGuiaR($idBloquear)
{
    include('../config.php');
    $sql = "UPDATE recepcion set status = '1' where id_recepcion = " . $idBloquear;
    $rs_operacion = mysqli_query($link, $sql);

    $sql = "UPDATE recepcion_pesos set status = '1' where id_recepcion = " . $idBloquear;
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $idBloquear;
    }
}

function listaProveedoresCPaginada($inicio, $fin, $busqueda)
{
    include('../config.php');

    $sql = "SELECT codigog,
                       fechaexp,
                       responsables.nombres as responsable,
                       destinos.sede as sede,
                       conductores.nombres as conductor,
                       placa,
                       guias.tipo,
                       id_guia,
                       consecutivog,
                       destinos.empresa as empresa,
                       guias.status
                FROM 
                    guias
                INNER JOIN 
                    responsables ON guias.responsable = responsables.cedula
                INNER JOIN 
                    destinos ON guias.destino = destinos.id
                INNER JOIN 
                    conductores ON guias.conductor = conductores.cedula
                WHERE
                    guias.tipo <> 'POLLO'";
    if (!empty($busqueda)) {
        $sql .= " AND (fechaexp LIKE '%$busqueda%'";
        $sql .= " OR destinos.sede LIKE '%$busqueda%'";
        $sql .= " OR conductores.nombres LIKE '%$busqueda%'";
        $sql .= " OR responsables.nombres LIKE '%$busqueda%'";
        $sql .= " OR codigog LIKE '%$busqueda%'";
        $sql .= " OR guias.tipo LIKE '%$busqueda%'";
        $sql .= " OR placa LIKE '%$busqueda%')";
    }

    $sql .= " ORDER BY id_guia DESC";

    $sql .= " LIMIT $inicio, $fin";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 2: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}

function listaProveedoresPPaginada($inicio, $fin, $busqueda)
{
    include('../config.php');

    $sql = "SELECT codigog,
                       fechaexp,
                       responsables.nombres as responsable,
                       destinos.sede as sede,
                       conductores.nombres as conductor,
                       placa,
                       guiaspollo.tipo,
                       id_guia,
                       consecutivog,
                       destinos.empresa as empresa,
                       guiaspollo.status,
                       canales
                FROM 
                    guiaspollo
                INNER JOIN 
                    responsables ON guiaspollo.responsable = responsables.cedula
                INNER JOIN 
                    destinos ON guiaspollo.destino = destinos.id
                INNER JOIN 
                    conductores ON guiaspollo.conductor = conductores.cedula";
    if (!empty($busqueda)) {
        $sql .= " WHERE (fechaexp LIKE '%$busqueda%'";
        $sql .= " OR destinos.sede LIKE '%$busqueda%'";
        $sql .= " OR conductores.nombres LIKE '%$busqueda%'";
        $sql .= " OR responsables.nombres LIKE '%$busqueda%'";
        $sql .= " OR codigog LIKE '%$busqueda%'";
        $sql .= " OR guiaspollo.tipo LIKE '%$busqueda%'";
        $sql .= " OR id_guia LIKE '%$busqueda%'";
        $sql .= " OR placa LIKE '%$busqueda%')";
    }

    $sql .= " ORDER BY id_guia DESC";

    $sql .= " LIMIT $inicio, $fin";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 2: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}
function listaProveedoresConPedidoPaginada($inicio, $fin, $busqueda, $fecha)
{
    include('../config.php');

    $sql = "SELECT nit,razon_social FROM proveedores WHERE nit in (SELECT proveedor FROM item_proveedor_compra WHERE fecha = '$fecha')";

    if (!empty($busqueda)) {
        $sql .= "and razon_social LIKE '%$busqueda%'";
    }

    $sql .= " ORDER BY razon_social ASC";

    $sql .= " LIMIT $inicio, $fin";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}
//inicia compradores
/* function agregarComprador($datosComprador){
    include('../config.php');
    $clave = md5($datosComprador['clave']);
    //$nombre = strtoupper($datosComprador['nombre']);
    $sql=" INSERT INTO 
    compradores(
        cedula,
        nombres,
        usuario,
        clave) 
        VALUES (
        '".$datosComprador['cedula']."',
        '".$datosComprador['nombre']."',
        '".$datosComprador['usuario']."',
        '".$clave."');";
    $rs_operacion=mysqli_query($link,$sql);
    
    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
      }
    else{
        return mysqli_insert_id($link);
    }
} */
/* function listaCompradoresCompleta()
{   include('../config.php');

        $sql = "SELECT cedula,nombres,usuario FROM compradores";
    
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
      }
    else{
        return $rs_operacion;
    }  
}

function listaCompradoresConFiltro($busqueda)
{   include('../config.php');

        $sql = "SELECT cedula,nombres,usuario FROM compradores";

        if (!empty($busqueda)) {
            $sql .= " WHERE nombres LIKE '%$busqueda%'";
        }
        $sql .= " ORDER BY nombres ASC";
    
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
      }
    else{
        return $rs_operacion;
    }  
}

function listaCompradoresPaginada($inicio, $fin, $busqueda)
{   include('../config.php');

        $sql = "SELECT cedula,nombres,usuario FROM compradores";

        if (!empty($busqueda)) {
            $sql .= " WHERE nombres LIKE '%$busqueda%'";
        }
    
        $sql .= " ORDER BY nombres ASC";
    
        $sql .= " LIMIT $inicio, $fin";
    
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
      }
    else{
        return $rs_operacion;
    }  
} */
//termina compadores

function listaItemsTablaCompleta($inicio, $fin)
{
    include('../config.php');
    $sql = "SELECT `item`,`codigo`,`descripcion`,`tipo`,`categoria`,`categoriadestino`,`status`,`id` FROM `plantilla`";
    $sql .= " ORDER BY descripcion DESC";
    $sql .= " LIMIT $inicio, $fin";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        //echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        echo $sql;
        exit();
    } else {
        return $rs_operacion;
    }
}

function listaItemsTabla($inicio, $fin, $busqueda)
{
    include('../config.php');
    $sql = "SELECT `item`,`codigo`,`descripcion`,`tipo`,`categoria`,`categoriadestino`,`status`,`id` FROM `plantilla`";

    if (!empty($busqueda)) {
        $sql .= " WHERE (item LIKE '%$busqueda%'";
        $sql .= " OR descripcion LIKE '%$busqueda%'";
        $sql .= " OR codigo LIKE '%$busqueda%'";
        $sql .= " OR categoria LIKE '%$busqueda%'";
        $sql .= " OR categoriadestino LIKE '%$busqueda%'";
        $sql .= " OR tipo LIKE '%$busqueda%')";
    }

    $sql .= " ORDER BY descripcion DESC";

    $sql .= " LIMIT $inicio, $fin";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta 1: " . mysqli_error($link);
        /* echo $sql; */
        exit();
    } else {
        return $rs_operacion;
    }
}

function listaItemsCompleta($inicio, $fin, $busqueda)
{
    include('../config.php');

    $sql = "SELECT item, descripcion, unidad 
            FROM plantilla 
            WHERE status = 'ACTIVO'";

    if (!empty($busqueda)) {
        $busqueda = mysqli_real_escape_string($link, $busqueda);
        $sql .= " AND descripcion LIKE '%$busqueda%'";
    }

    $sql .= " ORDER BY descripcion ASC";
    $sql .= " LIMIT $inicio, $fin";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        return mysqli_error($link);
    } else {
        return $rs_operacion;
    }
}

function listarItems($proveedor) {
    include('../config.php');

    $sql1 = "SELECT categoria 
          FROM plantilla 
          WHERE item in (select item 
                         from item_proveedor 
                         where proveedor = '" . $proveedor['id'] . "' and 
                               tipo = '" . $proveedor['tipo'] . "')";

    $categoria = '';
    $rs_operacion1 = mysqli_query($link, $sql1);
    $row1 = mysqli_fetch_array($rs_operacion1);
    $categoria = $row1['categoria'];

    if ($categoria != '') {
        $sql = "SELECT item, descripcion, codigo 
          FROM plantilla p 
          WHERE tipo = '" . $proveedor['tipo'] . "' and categoria = '" . $categoria . "' and status = 'ACTIVO'
          order by descripcion asc";
    } else {
        $sql = "SELECT item, descripcion, codigo 
          FROM plantilla p 
          WHERE tipo = '" . $proveedor['tipo'] . "' and status = 'ACTIVO'
        order by categoria, descripcion asc";
    }

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function listarItemsP($proveedor)
{
    include('../config.php');

    $sql1 = "SELECT categoriadestino 
          FROM plantilla 
          WHERE item in (select item 
                         from item_proveedorpollo 
                         where proveedor = '" . $proveedor['id'] . "' and 
                               tipo = '" . $proveedor['tipo'] . "')";

    $categoria = '';
    $rs_operacion1 = mysqli_query($link, $sql1);
    $row1 = mysqli_fetch_array($rs_operacion1);
    $categoria = $row1['categoriadestino'];
    if ($categoria != '') {
        $sql = "SELECT item, descripcion, codigo 
          FROM plantilla p 
          WHERE  
          categoriadestino = '" . $categoria . "' and
          status = 'ACTIVO'
          and  item <> '074567'
          order by descripcion asc";
    } else {
        $sql = "SELECT item, descripcion, codigo 
          FROM plantilla p 
          WHERE tipo = '" . $proveedor['tipo'] . "' and
                status = 'ACTIVO'
                and  item <> '074567'
          ORDER BY categoria, descripcion asc";
    }

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function listarSedes($compradorSede)
{
    include('../config.php');

    $sql = "SELECT cod, nombre 
          FROM sede 
          WHERE tipo = 2 AND comprador = ''
    ORDER BY empresa,nombre ASC";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function listaSedesConComprador()
{
    include('../config.php');

    $sql = "SELECT empresa, nombre,nombres 
          FROM sede 
          INNER JOIN compradores ON sede.comprador = compradores.cedula
          WHERE tipo = 2 AND comprador <> ''
    ORDER BY comprador,empresa,nombre ASC";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta SQL: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}

function listaSedeComprador()
{
    include('../config.php');
    $comprador = $_SESSION['comprador'];
    $sql = "SELECT campo 
          FROM sede 
          WHERE comprador = '" . $comprador . "'
    ORDER BY empresa,nombre ASC";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta SQL: " . mysqli_error($link);
        exit();
    } else {
        $campos = array();
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $campos[] = $row['campo'];
        }
        mysqli_free_result($rs_operacion);
        return $campos;
    }
}

function listaSedeCompleta()
{
    include('../config.php');
    include('config.php');
    $sql = "SELECT campo 
          FROM sede 
          WHERE campo<>''
          ORDER BY empresa,nombre ASC";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta SQL: " . mysqli_error($link);
        exit();
    } else {
        $campos = array();
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $campos[] = $row['campo'];
        }
        mysqli_free_result($rs_operacion);
        return $campos;
    }
}

function listaNombreSedeCompradorCompleta()
{
    include('./config.php');
    $comprador = $_SESSION['comprador'];
    $sql = "SELECT cod,nombre FROM sede 
          WHERE campo <> ''
    ORDER BY empresa,nombre ASC";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta SQL 1: " . mysqli_error($link);
        exit();
    } else {
        $campos = array();
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $campos[] = array('cod' => $row['cod'], 'nombre' => $row['nombre']);
        }
        mysqli_free_result($rs_operacion);
        return $campos;
    }
}

function listaNombreSedeComprador()
{
    include('./config.php');
    $comprador = $_SESSION['comprador'];
    $sql = "SELECT cod,nombre FROM sede 
          WHERE comprador = '" . $comprador . "'
    ORDER BY empresa,nombre ASC";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta SQL 1: " . mysqli_error($link);
        exit();
    } else {
        $campos = array();
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $campos[] = array('cod' => $row['cod'], 'nombre' => $row['nombre']);
        }
        mysqli_free_result($rs_operacion);
        return $campos;
    }
}

function listaItemsPorProveedor($proveedor)
{
    include('../config.php');

    $sql = "SELECT plantilla.item, 
                 descripcion,
                 lote,
                 temperatura,
                 unidades,
                 cajas,
                 peso,
                 registro,
                 id_item_proveedor,
                 peso_real,
                 item_proveedor.status,
                 tipo 
          FROM plantilla,item_proveedor 
          WHERE plantilla.item=item_proveedor.item AND item_proveedor.proveedor='" . $proveedor . "'
          ORDER BY id_item_proveedor desc";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta SQL: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}

function listaItemsPorProveedorPaginada($proveedor, $inicio, $fin, $busqueda)
{
    include('../config.php');

    $sql = "SELECT plantilla.item, 
                 descripcion,
                 lote,
                 temperatura,
                 unidades,
                 cajas,
                 peso,
                 registro,
                 id_item_proveedor,
                 peso_real,
                 item_proveedor.status,
                 tipo 
          FROM plantilla,item_proveedor 
          WHERE plantilla.item=item_proveedor.item AND item_proveedor.proveedor='" . $proveedor . "'";

    if (!empty($busqueda)) {
        $sql .= " AND descripcion LIKE '%$busqueda%'";
    }

    $sql .= " ORDER BY id_item_proveedor desc";
    $sql .= " LIMIT $inicio, $fin";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta SQL: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}

function listaItemsPorProveedorP($proveedor)
{
    include('../config.php');

    $sql = "SELECT plantilla.item, 
                 descripcion,
                 lote,
                 temperatura,
                 unidades,
                 cajas,
                 peso,
                 registro,
                 id_item_proveedor,
                 peso_real,
                 item_proveedorpollo.status,
                 tipo,
                 base 
          FROM plantilla,item_proveedorpollo 
          WHERE plantilla.item=item_proveedorpollo.item AND item_proveedorpollo.proveedor='" . $proveedor . "'
          ORDER BY id_item_proveedor desc";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta SQL: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}

function listaItemsPorProveedorP2($proveedor)
{
    include('../config.php');

    $sql = "SELECT plantilla.item, 
                 descripcion,
                 temperatura,
                 unidades,
                 cajas,
                 peso,
                 registro,
                 id_item_proveedor,
                 peso_real,
                 recepcion_pesos_pollo.status,
                 tipo,
                 base,
                 pesocanastilla,
                 observacion,
                 foto
          FROM plantilla,recepcion_pesos_pollo 
          WHERE plantilla.item=recepcion_pesos_pollo.item AND recepcion_pesos_pollo.proveedor='" . $proveedor . "'
          ORDER BY id_item_proveedor desc";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta SQL: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}

function listaItemsPorProveedorPPaginada($proveedor, $inicio, $fin, $busqueda)
{
    include('../config.php');

    $sql = "SELECT plantilla.item, 
                 descripcion,
                 lote,
                 temperatura,
                 unidades,
                 cajas,
                 peso,
                 registro,
                 id_item_proveedor,
                 peso_real,
                 item_proveedorpollo.status,
                 tipo,
                 pesocanastilla,
                 observacion,
                 foto
          FROM plantilla,item_proveedorpollo 
          WHERE plantilla.item=item_proveedorpollo.item AND item_proveedorpollo.proveedor='" . $proveedor . "'";

    if (!empty($busqueda)) {
        $sql .= " AND descripcion LIKE '%$busqueda%'";
    }

    $sql .= " ORDER BY id_item_proveedor desc";
    //$sql .= " LIMIT $inicio, $fin";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta SQL: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}

function listaPesosPorRecepcion($Recepcion)
{
    include('../config.php');

    $sql = "SELECT id_recepcion_pesos, 
                 id_recepcion,
                 turno,
                 estomago1,
                 estomago2,
                 piernas1,
                 piernas2,
                 total,
                 status,
                 registro,
                 temperatura,
                 observacion,
                 foto
          FROM recepcion_pesos 
          WHERE id_recepcion='" . $Recepcion . "'
          ORDER BY id_recepcion_pesos desc";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta SQL: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}

function listaPesosPorRecepcionInv($Recepcion)
{
    include('../config.php');

    $sql = "SELECT id_recepcion_pesos, 
                 id_recepcion,
                 turno,
                 estomago1,
                 estomago2,
                 piernas1,
                 piernas2,
                 total,
                 status,
                 registro,
                 temperatura,
                 observacion,
                 foto,
                 inventario,
                 diferencia
          FROM recepcion_pesos 
          WHERE id_recepcion='" . $Recepcion . "'
          ORDER BY turno asc";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta SQL: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}

function listaPesosPorRecepcionPaginada($Recepcion, $inicio, $fin, $busqueda)
{
    include('../config.php');

    $sql = "SELECT id_recepcion_pesos, 
                 id_recepcion,
                 turno,
                 estomago1,
                 estomago2,
                 piernas1,
                 piernas2,
                 total,
                 status,
                 registro,
                 temperatura,
                 observacion,
                 foto
          FROM recepcion_pesos 
          WHERE id_recepcion='" . $Recepcion . "'";

    if (!empty($busqueda)) {
        $sql .= " AND (turno LIKE '%$busqueda%'";
        $sql .= " OR status LIKE '%$busqueda%'";
        $sql .= " OR temperatura LIKE '%$busqueda%')";
    }

    $sql .= " ORDER BY id_recepcion_pesos DESC";

    $sql .= " LIMIT $inicio, $fin";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta SQL: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}

function listaPesosPorRecepcionPaginadaInv($Recepcion, $inicio, $fin, $busqueda)
{
    include('../config.php');

    $sql = "SELECT id_recepcion_pesos, 
                 id_recepcion,
                 turno,
                 estomago1,
                 estomago2,
                 piernas1,
                 piernas2,
                 total,
                 status,
                 registro,
                 temperatura,
                 observacion,
                 foto,
                 inventario,
                 diferenciaPeso,
                 diferencia
          FROM recepcion_pesos 
          WHERE id_recepcion='" . $Recepcion . "'";

    if (!empty($busqueda)) {
        $sql .= " AND (turno LIKE '%$busqueda%'";
        $sql .= " OR status LIKE '%$busqueda%'";
        $sql .= " OR temperatura LIKE '%$busqueda%')";
    }

    $sql .= " ORDER BY turno ASC";

    //$sql .= " LIMIT $inicio, $fin";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta SQL: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}
function listaItemsCompradosFecha($item, $fecha)
{
    include('../config.php');

    $sql = "SELECT proveedor, razon_social, sede, nombre, cantidad, plantilla.item as item,id_item_proveedor
          FROM plantilla,item_proveedor_compra,proveedores,sede
          WHERE plantilla.item=item_proveedor_compra.item 
          AND item_proveedor_compra.item='" . $item . "'
          AND item_proveedor_compra.fecha='" . $fecha . "'
          AND item_proveedor_compra.proveedor=proveedores.nit
          AND (item_proveedor_compra.sede=sede.cod and sede.empresa=item_proveedor_compra.empresa)
          order by razon_social,sede asc";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta SQL: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}

function listaItemsCompradosFechaConFiltro($item, $fecha, $busqueda)
{
    include('../config.php');

    $sql = "SELECT proveedor, razon_social, sede, nombre, cantidad, plantilla.item as item,id_item_proveedor
          FROM plantilla,item_proveedor_compra,proveedores,sede
          WHERE plantilla.item=item_proveedor_compra.item 
          AND item_proveedor_compra.item='" . $item . "'
          AND item_proveedor_compra.fecha='" . $fecha . "'
          AND item_proveedor_compra.proveedor=proveedores.nit
          AND (item_proveedor_compra.sede=sede.cod and sede.empresa='" . $_SESSION['empresa'] . "')";

    if (!empty($busqueda)) {
        $sql .= " AND (razon_social LIKE '%$busqueda%' OR ";
        $sql .= "nombre LIKE '%$busqueda%' OR ";
        $sql .= "cantidad LIKE '%$busqueda%')";
    }

    $sql .= " ORDER BY sede,razon_social ASC";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta SQL: " . mysqli_error($link);
        exit();
    } else {
        return $rs_operacion;
    }
}

function listaProveedorPorItem($proveedorPorItem)
{
    include('../config.php');

    $sql = "SELECT nit, razon_social, precio, vigencia 
          FROM proveedores, item_proveedor 
          WHERE proveedores.nit = item_proveedor.proveedor 
          AND item_proveedor.item = '" . $proveedorPorItem . "'
          ORDER BY precio ASC";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function agregarItem($datos)
{
    include('../config.php');
    $hora = date("Y-m-d H:i:s");
    $peso_real = $datos['peso'] - ($datos['cajas'] * 1.8);
    $sql = " INSERT INTO item_proveedor(item,proveedor,lote,temperatura,unidades,cajas,peso,peso_real,registro) 
    VALUES (
        '" . $datos['item'] . "',
        '" . $datos['proveedor'] . "',
        '" . $datos['lote'] . "',
        '" . $datos['temperatura'] . "',
        '" . $datos['unidades'] . "',
        '" . $datos['cajas'] . "',
        '" . $datos['peso'] . "',
        '" . $peso_real . "',
        '" . $hora . "'
        );";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return mysqli_insert_id($link);
    }
}

/*
function agregarItemP($datos)
{
    include('../config.php');
    $hora = date("Y-m-d H:i:s");
    $peso_base = round($datos['base'] * 1.8);
    if ($datos['item'] != '999999') {
        // $peso_real = number_format(round($datos['peso'] - ($datos['cajas'] * 2) - ($datos['base'] *1.8)),2,",",".");
        $peso_real = number_format($datos['peso'] - (($datos['cajas']) * 1.8) - (($datos['base'] * 1.8)), 2, ",", ".");
        $sql = " INSERT INTO item_proveedorpollo(item,proveedor,lote,temperatura,unidades,cajas,base,peso,peso_real,registro) 
               VALUES (
                        '" . $datos['item'] . "',
                        '" . $datos['proveedor'] . "',
                        '" . $datos['lote'] . "',
                        '" . $datos['temperatura'] . "',
                        '" . $datos['unidades'] . "',
                        '" . $datos['cajas'] . "',
                        '" . $datos['base'] . "',
                        '" . $datos['peso'] . "',
                        '" . $peso_real . "',
                        '" . $hora . "'
                       );";
        $rs_operacion = mysqli_query($link, $sql);
    } else {
        $porcentaje_pechugas = 36;
        $porcentaje_muslos = 21;
        $porcentaje_contramuslos = 23;
        $porcentaje_alas = 20;

        $peso_pechugas = ($porcentaje_pechugas / 100) * $datos['peso'];
        $peso_muslos = ($porcentaje_muslos / 100) * $datos['peso'];
        $peso_contramuslos = ($porcentaje_contramuslos / 100) * $datos['peso'];
        $peso_alas = ($porcentaje_alas / 100) * $datos['peso'];
        //alas
        $item = '050514';
        $unidades = $datos['unidades'] * 2;
        $peso = number_format(round($peso_alas), 2, ",", ".");
        $peso_real = number_format($peso - (($datos['cajas'] *0.2) * 1.8) - (($datos['base'] * 1.8) / 4), 2, ",", ".");
        $cajas = $datos['cajas'] / 5;
        $sql = " INSERT INTO item_proveedorpollo(item,proveedor,lote,temperatura,unidades,cajas,base,peso,peso_real,registro) 
               VALUES (
                        '" . $item . "',
                        '" . $datos['proveedor'] . "',
                        '" . $datos['lote'] . "',
                        '" . $datos['temperatura'] . "',
                        '" . $unidades . "',
                        '" . $cajas . "',
                        '" . $datos['base'] . "',
                        '" . $peso . "',
                        '" . $peso_real . "',
                        '" . $hora . "'
                       );";

        $rs_operacion = mysqli_query($link, $sql);
        //muslo
        $item = '050516';
        $unidades = $datos['unidades'] * 2;
        $peso = number_format(round($peso_muslos), 2, ",", ".");
        $peso_real = number_format($peso - (($datos['cajas'] *0.2) * 1.8) - (($datos['base'] * 1.8) / 4), 2, ",", ".");
        $cajas = $datos['cajas'] / 5;
        $sql = " INSERT INTO item_proveedorpollo(item,proveedor,lote,temperatura,unidades,cajas,base,peso,peso_real,registro) 
               VALUES (
                        '" . $item . "',
                        '" . $datos['proveedor'] . "',
                        '" . $datos['lote'] . "',
                        '" . $datos['temperatura'] . "',
                        '" . $unidades . "',
                        '" . $cajas . "',
                        '" . $datos['base'] . "',
                        '" . $peso . "',
                        '" . $peso_real . "',
                        '" . $hora . "'
                       );";
        $rs_operacion = mysqli_query($link, $sql);
        //contra
        $item = '050515';
        $unidades = $datos['unidades'] * 2;
        $peso = number_format(round($peso_contramuslos), 2, ",", ".");
        $peso_real = number_format($peso - (($datos['cajas'] *0.2) * 1.8) - (($datos['base'] * 1.8) / 4), 2, ",", ".");
        $cajas = $datos['cajas'] / 5;
        $sql = " INSERT INTO item_proveedorpollo(item,proveedor,lote,temperatura,unidades,cajas,base,peso,peso_real,registro) 
               VALUES (
                        '" . $item . "',
                        '" . $datos['proveedor'] . "',
                        '" . $datos['lote'] . "',
                        '" . $datos['temperatura'] . "',
                        '" . $unidades . "',
                        '" . $cajas . "',
                        '" . $datos['base'] . "',
                        '" . $peso . "',
                        '" . $peso_real . "',
                        '" . $hora . "'
                       );";
        $rs_operacion = mysqli_query($link, $sql);
        //pechuga
        $item = '050517';
        $unidades = $datos['unidades'] * 2;
        $peso = number_format(round($peso_pechugas), 2, ",", ".");
        $peso_real = number_format($peso - (($datos['cajas'] *0.4) * 1.8) - (($datos['base'] * 1.8) / 4), 2, ",", ".");
        $cajas = $datos['cajas'] / 2.5;
        $sql = " INSERT INTO item_proveedorpollo(item,proveedor,lote,temperatura,unidades,cajas,base,peso,peso_real,registro) 
               VALUES (
                        '" . $item . "',
                        '" . $datos['proveedor'] . "',
                        '" . $datos['lote'] . "',
                        '" . $datos['temperatura'] . "',
                        '" . $unidades . "',
                        '" . $cajas . "',
                        '" . $datos['base'] . "',
                        '" . $peso . "',
                        '" . $peso_real . "',
                        '" . $hora . "'
                       );";
        $rs_operacion = mysqli_query($link, $sql);
    }
    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return mysqli_insert_id($link);
    }
}*/

function agregarItemP($datos)
{
    include('../config.php');
    $hora = date("Y-m-d H:i:s");
    $peso_base = round($datos['base'] * 1.8);
    if ($datos['item'] != '999999') {
        /* $peso_real = number_format(round($datos['peso'] - ($datos['cajas'] * 2) - ($datos['base'] *1.8)),2,",","."); */
        if($datos['item'] == '074700') {
            $peso_real = number_format($datos['peso'] - (($datos['cajas']) * 1.8) - (($datos['base'] * 1.8)), 2, ",", ".");
        }else{
            $peso_real = number_format($datos['peso'] - (($datos['cajas']) * 2) - (($datos['base'] * 1.8)), 2, ",", ".");
        }
        $sql = " INSERT INTO item_proveedorpollo(item,proveedor,lote,temperatura,unidades,cajas,base,peso,peso_real,registro) 
               VALUES (
                        '" . $datos['item'] . "',
                        '" . $datos['proveedor'] . "',
                        '" . $datos['lote'] . "',
                        '" . $datos['temperatura'] . "',
                        '" . $datos['unidades'] . "',
                        '" . $datos['cajas'] . "',
                        '" . $datos['base'] . "',
                        '" . $datos['peso'] . "',
                        '" . $peso_real . "',
                        '" . $hora . "'
                       );";
        $rs_operacion = mysqli_query($link, $sql);
    } else {
        $porcentaje_pechugas = 36;
        $porcentaje_muslos = 21;
        $porcentaje_contramuslos = 23;
        $porcentaje_alas = 20;

        $peso_pechugas = ($porcentaje_pechugas / 100) * $datos['peso'];
        $peso_muslos = ($porcentaje_muslos / 100) * $datos['peso'];
        $peso_contramuslos = ($porcentaje_contramuslos / 100) * $datos['peso'];
        $peso_alas = ($porcentaje_alas / 100) * $datos['peso'];
        //alas
        $item = '050514';
        $unidades = $datos['unidades'] * 2;
        $peso = number_format(round($peso_alas), 2, ",", ".");
        $peso_real = number_format($peso - (($datos['cajas'] / 4) * 1.8) - (($datos['base'] * 1.8) / 4), 2, ",", ".");
        $cajas = $datos['cajas'] / 4;
        $sql = " INSERT INTO item_proveedorpollo(item,proveedor,lote,temperatura,unidades,cajas,base,peso,peso_real,registro) 
               VALUES (
                        '" . $item . "',
                        '" . $datos['proveedor'] . "',
                        '" . $datos['lote'] . "',
                        '" . $datos['temperatura'] . "',
                        '" . $unidades . "',
                        '" . $cajas . "',
                        '" . $datos['base'] . "',
                        '" . $peso . "',
                        '" . $peso_real . "',
                        '" . $hora . "'
                       );";

        $rs_operacion = mysqli_query($link, $sql);
        //muslo
        $item = '050516';
        $unidades = $datos['unidades'] * 2;
        $peso = number_format(round($peso_muslos), 2, ",", ".");
        $peso_real = number_format($peso - (($datos['cajas'] / 4) * 1.8) - (($datos['base'] * 1.8) / 4), 2, ",", ".");
        $cajas = $datos['cajas'] / 4;
        $sql = " INSERT INTO item_proveedorpollo(item,proveedor,lote,temperatura,unidades,cajas,base,peso,peso_real,registro) 
               VALUES (
                        '" . $item . "',
                        '" . $datos['proveedor'] . "',
                        '" . $datos['lote'] . "',
                        '" . $datos['temperatura'] . "',
                        '" . $unidades . "',
                        '" . $cajas . "',
                        '" . $datos['base'] . "',
                        '" . $peso . "',
                        '" . $peso_real . "',
                        '" . $hora . "'
                       );";
        $rs_operacion = mysqli_query($link, $sql);
        //contra
        $item = '050515';
        $unidades = $datos['unidades'] * 2;
        $peso = number_format(round($peso_contramuslos), 2, ",", ".");
        $peso_real = number_format($peso - (($datos['cajas'] / 4) * 1.8) - (($datos['base'] * 1.8) / 4), 2, ",", ".");
        $cajas = $datos['cajas'] / 4;
        $sql = " INSERT INTO item_proveedorpollo(item,proveedor,lote,temperatura,unidades,cajas,base,peso,peso_real,registro) 
               VALUES (
                        '" . $item . "',
                        '" . $datos['proveedor'] . "',
                        '" . $datos['lote'] . "',
                        '" . $datos['temperatura'] . "',
                        '" . $unidades . "',
                        '" . $cajas . "',
                        '" . $datos['base'] . "',
                        '" . $peso . "',
                        '" . $peso_real . "',
                        '" . $hora . "'
                       );";
        $rs_operacion = mysqli_query($link, $sql);
        //pechuga
        $item = '050517';
        $unidades = $datos['unidades'] * 2;
        $peso = number_format(round($peso_pechugas), 2, ",", ".");
        $peso_real = number_format($peso - (($datos['cajas'] / 4) * 1.8) - (($datos['base'] * 1.8) / 4), 2, ",", ".");
        $cajas = $datos['cajas'] / 4;
        $sql = " INSERT INTO item_proveedorpollo(item,proveedor,lote,temperatura,unidades,cajas,base,peso,peso_real,registro) 
               VALUES (
                        '" . $item . "',
                        '" . $datos['proveedor'] . "',
                        '" . $datos['lote'] . "',
                        '" . $datos['temperatura'] . "',
                        '" . $unidades . "',
                        '" . $cajas . "',
                        '" . $datos['base'] . "',
                        '" . $peso . "',
                        '" . $peso_real . "',
                        '" . $hora . "'
                       );";
        $rs_operacion = mysqli_query($link, $sql);
    }
    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return mysqli_insert_id($link);
    }
}
function agregarItemRecepcionPollo($datos)
{
    include('../config.php');
    $hora = date("Y-m-d H:i:s");
    $peso_base = round($datos['base'] * 1.8);
    $peso_real = number_format($datos['peso'] - (($datos['cajas']) * $datos['pesocanastilla']) - (($datos['base'] * 1.8)), 2, ",", ".");
    $sql = " INSERT INTO recepcion_pesos_pollo(item,proveedor,temperatura,unidades,cajas,base,peso,peso_real,pesocanastilla,registro,observacion,foto) 
               VALUES (
                        '" . $datos['item'] . "',
                        '" . $datos['proveedor'] . "',
                        '" . $datos['temperatura'] . "',
                        '" . $datos['unidades'] . "',
                        '" . $datos['cajas'] . "',
                        '" . $datos['base'] . "',
                        '" . $datos['peso'] . "',
                        '" . $peso_real . "',
                        '" . $datos['pesocanastilla'] . "',
                        '" . $hora . "',
                        '" . $datos['observacionPollo'] . "',
                        '" . $datos['fotoForm'] . "'
                       );";
    $rs_operacion = mysqli_query($link, $sql);

    $id_registro = mysqli_insert_id($link);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return $id_registro;
    }
}

/* function agregarPeso($datos){
    include('../config.php');
    $hora = date("Y-m-d H:i:s");
    
    $sql = "SELECT * 
            FROM recepcion_pesos 
            WHERE id_recepcion = '".$datos['recepcion']."'
            AND turno = '".$datos['turno']."'";
    $rs_operacion = mysqli_query($link, $sql);
    
    if ($row = mysqli_fetch_assoc($rs_operacion)) {
        $respuesta = [
            'status' => 'warning',
            'message' => 'Ya existe',
            'data' => $datos
        ];
        return json_encode($respuesta);
    } else {
        $sql = "INSERT INTO recepcion_pesos(id_recepcion, turno, estomago1, total, registro) 
                VALUES ('".$datos['recepcion']."',
                        '".$datos['turno']."',
                        '".$datos['peso']."',
                        '".$datos['peso']."',
                        '".$hora."');";
        $rs_operacion = mysqli_query($link, $sql);
        if (!$rs_operacion) {
            $respuesta = [
                'status' => 'error',
                'message' => 'Error al ejecutar la consulta: ' . mysqli_error($link)
            ];
            return json_encode($respuesta);
        } else {
            $respuesta = [
                'status' => 'success',
                'message' => 'Peso registrado satisfactoriamente',
                'id' => mysqli_insert_id($link)
            ];
            return json_encode($respuesta);
        }
    }
} */

function agregarPeso($datos)
{
    include('../config.php');
    $hora = date("Y-m-d H:i:s");

    $sql = "SELECT * FROM recepcion_pesos 
            WHERE id_recepcion = '" . $datos['recepcion'] . "' 
            AND turno = '" . $datos['turno'] . "'";
    $rs_operacion = mysqli_query($link, $sql);

    if ($row = mysqli_fetch_assoc($rs_operacion)) {
        if ($datos['parte'] == "ESTOMAGO") {
            if ($row['estomago1'] == "0") {

                if ($datos['temperaturap'] == '') {
                    $sql = "UPDATE recepcion_pesos SET estomago1 = '" . $datos['peso'] . "', registro = '" . $hora . "',observacion = '" . $datos['observacionPeso'] . "', foto = '" . $datos['foto'] . "' WHERE id_recepcion = '" . $datos['recepcion'] . "' AND turno = '" . $datos['turno'] . "'";
                } else {
                    $sql = "UPDATE recepcion_pesos SET estomago1 = '" . $datos['peso'] . "', temperatura = '" . $datos['temperaturap'] . "', observacion = '" . $datos['observacionPeso'] . "', foto = '" . $datos['foto'] . "', registro = '" . $hora . "'  
                    WHERE id_recepcion = '" . $datos['recepcion'] . "' AND turno = '" . $datos['turno'] . "'";
                }

                $rs_operacion = mysqli_query($link, $sql);
                $respuesta = [
                    'status' => 'success',
                    'message' => 'Peso ESTOMAGO1 registrado satisfactoriamente'
                ];
                return json_encode($respuesta);
            } elseif ($row['estomago2'] == "0") {

                if ($datos['temperaturap'] == '') {
                    $sql = "UPDATE recepcion_pesos SET estomago2 = '" . $datos['peso'] . "', registro2 = '" . $hora . "',observacion = '" . $datos['observacionPeso'] . "', foto = '" . $datos['foto'] . "' WHERE id_recepcion = '" . $datos['recepcion'] . "' AND turno = '" . $datos['turno'] . "'";
                } else {
                    $sql = "UPDATE recepcion_pesos SET estomago2 = '" . $datos['peso'] . "',temperatura = '" . $datos['temperaturap'] . "', observacion = '" . $datos['observacionPeso'] . "', foto = '" . $datos['foto'] . "', registro2 = '" . $hora . "' 
                        WHERE id_recepcion = '" . $datos['recepcion'] . "' AND turno = '" . $datos['turno'] . "'";
                }

                $rs_operacion = mysqli_query($link, $sql);
                $respuesta = [
                    'status' => 'success',
                    'message' => 'Peso ESTOMAGO2 registrado satisfactoriamente'
                ];
                return json_encode($respuesta);
            } else {
                $respuesta = [
                    'status' => 'warning',
                    'message' => 'Los estmagos de este turno ya estn registrados, por favor verifique el turno'
                ];
                return json_encode($respuesta);
            }
        } else {
            if ($row['piernas1'] == "0") {

                if ($datos['temperaturap'] == '') {
                    $sql = "UPDATE recepcion_pesos SET piernas1 = '" . $datos['peso'] . "', registro3 = '" . $hora . "', observacion = '" . $datos['observacionPeso'] . "', foto = '" . $datos['foto'] . "' WHERE id_recepcion = '" . $datos['recepcion'] . "' AND turno = '" . $datos['turno'] . "'";
                } else {
                    $sql = "UPDATE recepcion_pesos SET piernas1 = '" . $datos['peso'] . "',temperatura = '" . $datos['temperaturap'] . "', observacion = '" . $datos['observacionPeso'] . "', foto = '" . $datos['foto'] . "', registro3 = '" . $hora . "' 
                        WHERE id_recepcion = '" . $datos['recepcion'] . "' AND turno = '" . $datos['turno'] . "'";
                }

                $rs_operacion = mysqli_query($link, $sql);
                $respuesta = [
                    'status' => 'success',
                    'message' => 'Peso PIERNAS1 registrado satisfactoriamente'
                ];
                return json_encode($respuesta);
            } elseif ($row['piernas2'] == "0") {

                if ($datos['temperaturap'] == '') {
                    $sql = "UPDATE recepcion_pesos SET piernas2 = '" . $datos['peso'] . "', registro4 = '" . $hora . "', observacion = '" . $datos['observacionPeso'] . "', foto = '" . $datos['foto'] . "' WHERE id_recepcion = '" . $datos['recepcion'] . "' AND turno = '" . $datos['turno'] . "'";
                } else {
                    $sql = "UPDATE recepcion_pesos SET piernas2 = '" . $datos['peso'] . "',temperatura = '" . $datos['temperaturap'] . "', observacion = '" . $datos['observacionPeso'] . "', foto = '" . $datos['foto'] . "', registro4 = '" . $hora . "'
                        WHERE id_recepcion = '" . $datos['recepcion'] . "' AND turno = '" . $datos['turno'] . "'";
                }

                $rs_operacion = mysqli_query($link, $sql);
                $respuesta = [
                    'status' => 'success',
                    'message' => 'Peso PIERNAS2 registrado satisfactoriamente'
                ];
                return json_encode($respuesta);
            } else {
                $respuesta = [
                    'status' => 'warning',
                    'message' => 'Las piernas de este turno ya estn registradas, por favor verifique el turno'
                ];
                return json_encode($respuesta);
            }
        }
    } else {
        if ($datos['parte'] == "ESTOMAGO") {
            $sql = "INSERT INTO recepcion_pesos(id_recepcion, turno, estomago1, temperatura, observacion, foto, registro) 
                    VALUES ('" . $datos['recepcion'] . "', 
                            '" . $datos['turno'] . "', 
                            '" . $datos['peso'] . "', 
                            '" . $datos['temperaturap'] . "', 
                            '" . $datos['observacionPeso'] . "', 
                            '" . $datos['foto'] . "',
                            '" . $hora . "')";
            $rs_operacion = mysqli_query($link, $sql);
            if (!$rs_operacion) {
                $respuesta = [
                    'status' => 'error',
                    'message' => 'Error al ejecutar la consulta: ' . mysqli_error($link)
                ];
                return json_encode($respuesta);
            } else {
                $respuesta = [
                    'status' => 'success',
                    'message' => 'Peso ESTOMAGO1 registrado satisfactoriamente',
                    'id' => mysqli_insert_id($link)
                ];
                return json_encode($respuesta);
            }
        } else {
            $sql = "INSERT INTO recepcion_pesos(id_recepcion, turno, piernas1, temperatura, observacion, foto, registro3) 
                    VALUES ('" . $datos['recepcion'] . "', 
                            '" . $datos['turno'] . "', 
                            '" . $datos['peso'] . "', 
                            '" . $datos['temperatura'] . "',
                            '" . $datos['observacionPeso'] . "', 
                            '" . $datos['foto'] . "', 
                            '" . $hora . "')";
            $rs_operacion = mysqli_query($link, $sql);
            if (!$rs_operacion) {
                $respuesta = [
                    'status' => 'error',
                    'message' => 'Error al ejecutar la consulta: ' . mysqli_error($link)
                ];
                return json_encode($respuesta);
            } else {
                $respuesta = [
                    'status' => 'success',
                    'message' => 'Peso PIERNAS1 registrado satisfactoriamente',
                    'id' => mysqli_insert_id($link)
                ];
                return json_encode($respuesta);
            }
        }
    }
}

function agregarPesoCerdo($datos)
{
    include('../config.php');
    $hora = date("Y-m-d H:i:s");

    $sql = "SELECT * FROM recepcion_pesos 
            WHERE id_recepcion = '" . $datos['recepcion'] . "' 
            AND turno = '" . $datos['turno'] . "'";
    $rs_operacion = mysqli_query($link, $sql);

    if ($row = mysqli_fetch_assoc($rs_operacion)) {
        $respuesta = [
            'status' => 'warning',
            'message' => 'El peso de este turno ya esta registrados, por favor verifique el turno'
        ];
        return json_encode($respuesta);
    } else {
        $sql = "INSERT INTO recepcion_pesos(id_recepcion, turno, estomago1, temperatura, observacion, foto, registro) 
                    VALUES ('" . $datos['recepcion'] . "', 
                            '" . $datos['turno'] . "', 
                            '" . $datos['peso'] . "', 
                            '" . $datos['temperaturap'] . "',
                            '" . $datos['observacionPeso'] . "', 
                            '" . $datos['foto'] . "',  
                            '" . $hora . "')";
        $rs_operacion = mysqli_query($link, $sql);
        if (!$rs_operacion) {
            $respuesta = [
                'status' => 'error',
                'message' => 'Error al ejecutar la consulta: ' . mysqli_error($link)
            ];
            return json_encode($respuesta);
        } else {
            $respuesta = [
                'status' => 'success',
                'message' => 'Peso registrado satisfactoriamente',
                'id' => mysqli_insert_id($link)
            ];
            return json_encode($respuesta);
        }
    }
}

function agregarResponsable($datosResp)
{
    include('../config.php');
    $sql = " INSERT INTO responsables(cedula,nombres,telefono,status) 
    VALUES (
        '" . $datosResp['cedula'] . "',
        '" . $datosResp['nombres'] . "',
        '" . $datosResp['telefono'] . "',
        '" . $datosResp['status'] . "'
        );";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return mysqli_insert_id($link);
    }
}

function agregarConductor($datosCond)
{
    include('../config.php');
    $sql = " INSERT INTO conductores(cedula,nombres,telefono,status) 
    VALUES (
        '" . $datosCond['cedula'] . "',
        '" . $datosCond['nombres'] . "',
        '" . $datosCond['telefono'] . "',
        '" . $datosCond['status'] . "'
        );";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return mysqli_insert_id($link);
    }
}

function agregarNuevoItem($datosItem)
{
    include('../config.php');
    $sql = " INSERT INTO plantilla(item,descripcion,codigo,tipo,categoria,categoriadestino,status) 
    VALUES (
        '" . $datosItem['item'] . "',
        '" . $datosItem['descripcion'] . "',
        '" . $datosItem['codigo'] . "',
        '" . $datosItem['tipo'] . "',
        '" . $datosItem['categoria'] . "',
        '" . $datosItem['subcategoria'] . "',
        '" . $datosItem['status'] . "'
        );";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function agregarNuevoResponsable($datosResponsable)
{
    include('../config.php');
    $clave = md5($datosResponsable['clave']);
    $sql = " INSERT INTO responsables(cedula,nombres,telefono,status,clave) 
    VALUES (
        '" . $datosResponsable['cedula'] . "',
        '" . $datosResponsable['nombres'] . "',
        '" . $datosResponsable['telefono'] . "',
        '" . $datosResponsable['status'] . "',
        '" . $clave . "'
        );";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function agregarNuevaPlanta($datosResponsable)
{
    include('../config.php');
    $sql = " INSERT INTO beneficio(nit,sede,direccion,municipio,status) 
    VALUES (
        '" . $datosResponsable['nit'] . "',
        '" . $datosResponsable['razon'] . "',
        '" . $datosResponsable['direccion'] . "',
        '" . $datosResponsable['municipio'] . "',
        '" . $datosResponsable['status'] . "'
        );";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function agregarProveedorPollo($datosProveedorP)
{
    include('../config.php');
    $sql = " INSERT INTO proveedorpollo(nit,sede,direccion,municipio,polloporcanastillas,status) 
    VALUES (
        '" . $datosProveedorP['nit'] . "',
        '" . $datosProveedorP['razon'] . "',
        '" . $datosProveedorP['direccion'] . "',
        '" . $datosProveedorP['municipio'] . "',
        '" . $datosProveedorP['polloporcanastillas'] . "',
        '" . $datosProveedorP['status'] . "'
        );";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function agregarNuevoConductorD($datosConductorD)
{
    include('../config.php');
    $sql = " INSERT INTO conductores(cedula,nombres,telefono,status) 
    VALUES (
        '" . $datosConductorD['cedula'] . "',
        '" . $datosConductorD['nombres'] . "',
        '" . $datosConductorD['telefono'] . "',
        '" . $datosConductorD['status'] . "'
        );";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function agregarPlaca($datosPlaca)
{
    include('../config.php');
    $sql = " INSERT INTO placas(placa,status) 
    VALUES (
        '" . $datosPlaca['cedula'] . "',
        '" . $datosPlaca['status'] . "'
        );";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return mysqli_insert_id($link);
    }
}

function agregarPlacaD($datosPlaca)
{
    include('../config.php');
    $sql = " INSERT INTO placas(placa,status) 
    VALUES (
        '" . $datosPlaca['placa'] . "',
        '" . $datosPlaca['status'] . "'
        );";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        if (!$rs_operacion) {
            return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
        } else {
            return array("status" => "success", "id" => mysqli_insert_id($link));
        }
    }
}

function agregarSede($datosSede)
{
    include('../config.php');

    $sql = " UPDATE sede SET comprador = '" . $datosSede['comprador'] . "' WHERE nombre = '" . $datosSede['sede'] . "';";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return mysqli_insert_id($link);
    }
}

function eliminarSede($datosEliminarSede)
{
    include('../config.php');

    $sql = " UPDATE sede SET comprador = '' WHERE nombre = '" . $datosEliminarSede['sede'] . "';";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return $datosEliminarSede['sede'];
    }
}

/*
function agregarGuia($datosGuia){
    include('../config.php');
    $sql=" INSERT INTO 
    guias(
        canales,
        fechaexp,
        consecutivog,
        responsable,
        destino,
        conductor,
        placa,
        tipo,
        precinto,
        observaciones
        ) 
        VALUES (
        '".$datosGuia['canales']."',
        '".$datosGuia['fechaexp']."',
        '".$datosGuia['consecutivog']."',
        '".$datosGuia['responsable']."',
        '".$datosGuia['destino']."',
        '".$datosGuia['conductor']."',
        '".$datosGuia['placa']."',
        '".$datosGuia['producto']."',
        '".$datosGuia['precinto']."',
        '".$datosGuia['observaciones']."');";
    $rs_operacion=mysqli_query($link,$sql);
    
    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
      }
    else{
        return mysqli_insert_id($link);
    }
}
*/
function agregarGuia($datosGuia)
{
    include('../config.php');

    $sql = "INSERT INTO guias (canales, fechaexp, consecutivog, responsable, destino, conductor, placa, tipo, precinto, observaciones) VALUES (
        '" . $datosGuia['canales'] . "',
        '" . $datosGuia['fechaexp'] . "',
        '" . $datosGuia['consecutivog'] . "',
        '" . $datosGuia['responsable'] . "',
        '" . $datosGuia['destino'] . "',
        '" . $datosGuia['conductor'] . "',
        '" . $datosGuia['placa'] . "',
        '" . $datosGuia['producto'] . "',
        '" . $datosGuia['precinto'] . "',
        '" . $datosGuia['observaciones'] . "'
    )";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function agregarGuiaP($datosGuia)
{
    include('../config.php');

    $sql = "INSERT INTO guiaspollo (canales, fechaexp, consecutivog, responsable, destino, conductor, placa, tipo, precinto, observaciones) VALUES (
        '" . $datosGuia['canales'] . "',
        '" . $datosGuia['fechaexp'] . "',
        '" . $datosGuia['consecutivog'] . "',
        '" . $datosGuia['responsable'] . "',
        '" . $datosGuia['destino'] . "',
        '" . $datosGuia['conductor'] . "',
        '" . $datosGuia['placa'] . "',
        'POLLO',
        '" . $datosGuia['precinto'] . "',
        '" . $datosGuia['observaciones'] . "'
    )";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function agregarRecepcion($datosGuia)
{
    include('../config.php');
    $sql = " INSERT INTO 
    recepcion(
        fecharec,
        fechasac,
        tipo,
        remision,
        canales,
        recibo,
        consecutivog,
        responsable,
        beneficio,
        destino,
        conductor,
        placa,
        lotep,
        ica,
        guiat,
        certificadoc,
        cph1,
        cph2,
        cph3,
        cph4,
        cph5,
        chv1,
        chv2,
        chv3,
        chv4,
        ccoh1,
        ccoh2,
        ccoh3,
        ccoh4,
        ccoh5,
        ccoh6,
        ccoh7,
        ccoh8,
        ccoh9,
        ccoh10,
        observaciones
        ) 
        VALUES (
            '" . $datosGuia['fecharec'] . "',
            '" . $datosGuia['fechasac'] . "',
            '" . $datosGuia['tipo'] . "',
            '" . $datosGuia['remision'] . "',
            '" . $datosGuia['canales'] . "',
            '" . $datosGuia['despacho'] . "',
            '" . $datosGuia['consecutivog'] . "',
            '" . $datosGuia['responsable'] . "',
            '" . $datosGuia['beneficio'] . "',
            '" . $datosGuia['destino'] . "',
            '" . $datosGuia['conductor'] . "',
            '" . $datosGuia['placa'] . "',
            '" . $datosGuia['lotep'] . "',
            '" . $datosGuia['ica'] . "',
            '" . $datosGuia['guiat'] . "',
            '" . $datosGuia['certificadoc'] . "',
            '" . $datosGuia['cph1'] . "',
            '" . $datosGuia['cph2'] . "',
            '" . $datosGuia['cph3'] . "',
            '" . $datosGuia['cph4'] . "',
            '" . $datosGuia['cph5'] . "',
            '" . $datosGuia['chv1'] . "',
            '" . $datosGuia['chv2'] . "',
            '" . $datosGuia['chv3'] . "',
            '" . $datosGuia['chv4'] . "',
            '" . $datosGuia['ccoh1'] . "',
            '" . $datosGuia['ccoh2'] . "',
            '" . $datosGuia['ccoh3'] . "',
            '" . $datosGuia['ccoh4'] . "',
            '" . $datosGuia['ccoh5'] . "',
            '" . $datosGuia['ccoh6'] . "',
            '" . $datosGuia['ccoh7'] . "',
            '" . $datosGuia['ccoh8'] . "',
            '" . $datosGuia['ccoh9'] . "',
            '" . $datosGuia['ccoh10'] . "',
            '" . $datosGuia['observaciones'] . "');";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return mysqli_insert_id($link);
    }
}

function agregarRecepcionPollo($datosGuia)
{
    include('../config.php');
    $sql = " INSERT INTO 
    recepcionpollo(
        fecharec,
        fechasac,
        canales,
        consecutivog,
        responsable,
        especie,
        tipo,
        beneficio,
        destino,
        conductor,
        placa,
        guiat,
        cph1,
        cph2,
        cph3,
        cph4,
        cph5,
        chv1,
        chv2,
        chv3,
        chv4,
        ccoh1,
        ccoh2,
        ccoh3,
        ccoh4,
        ccoh5,
        observaciones,
        lote_planta
        ) 
        VALUES (
            '" . $datosGuia['fecharec'] . "',
            '" . $datosGuia['fechasac'] . "',
            '" . $datosGuia['canales'] . "',
            '" . $datosGuia['consecutivog'] . "',
            '" . $datosGuia['responsable'] . "',
            '" . $datosGuia['especie'] . "',
            '" . $datosGuia['tipo'] . "',
            '" . $datosGuia['beneficio'] . "',
            '" . $datosGuia['destino'] . "',
            '" . $datosGuia['conductor'] . "',
            '" . $datosGuia['placa'] . "',
            '" . $datosGuia['guiat'] . "',
            '" . $datosGuia['cph1'] . "',
            '" . $datosGuia['cph2'] . "',
            '" . $datosGuia['cph3'] . "',
            '" . $datosGuia['cph4'] . "',
            '" . $datosGuia['cph5'] . "',
            '" . $datosGuia['chv1'] . "',
            '" . $datosGuia['chv2'] . "',
            '" . $datosGuia['chv3'] . "',
            '" . $datosGuia['chv4'] . "',
            '" . $datosGuia['ccoh1'] . "',
            '" . $datosGuia['ccoh2'] . "',
            '" . $datosGuia['ccoh3'] . "',
            '" . $datosGuia['ccoh4'] . "',
            '" . $datosGuia['ccoh5'] . "',
            '" . $datosGuia['observaciones'] . "',
            '" . $datosGuia['lotePlanta'] . "')
        ";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $id_recepcion = mysqli_insert_id($link);

        $sql = "SELECT hora_recepcion_pollo
                FROM hora_temporal
                WHERE id = 1";

        $rs_operacion = mysqli_query($link, $sql);

        if ($row = mysqli_fetch_array($rs_operacion)) {
            $sql = "UPDATE recepcionpollo set 
                hora_inicial= '" . $row['hora_recepcion_pollo'] . "'
                where id_recepcion = " . $id_recepcion;
            $rs_operacion = mysqli_query($link, $sql);
            if (!$rs_operacion) {
                echo "Error al ejecutar la consulta: " . mysqli_error($link);
                exit();
            } else {
                return $id_recepcion;
            }
        }
    }
}

function agregarItemCompra($datosCompra)
{
    include('../config.php');
    $contador = 0;
    foreach ($datosCompra as $datoCompra) {
        if (($datoCompra['cantidad'] > 0) && ($datoCompra['cantidad'] != '')) {
            $contador++;
            $sqlEmpresa = "SELECT empresa,cod FROM sede WHERE nombre='" . $datoCompra['sede'] . "'";
            $rsEmpresa = mysqli_query($link, $sqlEmpresa);
            if ($row = mysqli_fetch_array($rsEmpresa)) {
                $empresa = $row['empresa'];
                $sede = $row['cod'];
            }

            $sql = " INSERT INTO 
    item_proveedor_compra(
        item,
        proveedor,
        cantidad,
        empresa,
        sede,
        precio,
        fecha) 
        VALUES (
        '" . $datoCompra['item'] . "',
        '" . $datoCompra['proveedor'] . "',
        '" . $datoCompra['cantidad'] . "',
        '" . $empresa . "',
        '" . $sede . "',
        '" . $datoCompra['precio'] . "',
        '" . $datoCompra['fecha'] . "');";
            if (!mysqli_query($link, $sql)) {
                return mysqli_error($link);
            }
        }
    }
    return $contador;
}

function eliminarItem($datos)
{
    include('../config.php');

    $sql = " DELETE FROM item_proveedor WHERE id_item_proveedor = '" . $datos['id_item_proveedor'] . "' and proveedor = '" . $datos['proveedor'] . "'";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return $datos['id_item_proveedor'];
    }
}

function eliminarItemP($datos)
{
    include('../config.php');

    $sql = " DELETE FROM item_proveedorpollo WHERE id_item_proveedor = '" . $datos['id_item_proveedor'] . "' and proveedor = '" . $datos['proveedor'] . "'";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return $datos['id_item_proveedor'];
    }
}

function eliminarItemPolloR($datos)
{
    include('../config.php');

    $sql2 = "SELECT foto FROM recepcion_pesos_pollo WHERE id_item_proveedor = '".$datos['id_item_proveedor']."'";
    $foto = mysqli_fetch_row(mysqli_query($link, $sql2));
    $archivo = "../controlador/recepcion pollo/".$foto[0];
    if (file_exists($archivo)) {
        unlink($archivo);
    }

    $sql = " DELETE FROM recepcion_pesos_pollo WHERE id_item_proveedor = '" . $datos['id_item_proveedor'] . "' and proveedor = '" . $datos['proveedor'] . "'";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return $datos['id_item_proveedor'];
    }
}

function eliminarItemPeso($datos)
{
    include('../config.php');

    $sql = " DELETE FROM recepcion_pesos WHERE id_recepcion_pesos = '" . $datos['id_item_proveedor'] . "'";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return $datos['id_item_proveedor'];
    }
}

function eliminarItemProveedor($item_proveedor_compra)
{
    include('../config.php');

    $sql = " DELETE FROM item_proveedor_compra WHERE id_item_proveedor = " . $item_proveedor_compra . "";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return $item_proveedor_compra;
    }
}

function buscarCedula($cedula)
{
    include('../config.php');
    $sql = "SELECT cedula 
            FROM conductores_recepcion 
            WHERE cedula = '" . $cedula . "'";
    $result = mysqli_query($link, $sql);
    if ($row = mysqli_fetch_array($result)) {
        $respuesta = "OC";
        return $respuesta;
    } else {
        $respuesta = "DESOCUPADO";
        return $respuesta;
    }
}

function buscarCedulaPollo($cedulaPollo)
{
    include('../config.php');
    $sql = "SELECT cedula 
            FROM conductores_recepcion_pollo 
            WHERE cedula = '" . $cedula . "'";
    $result = mysqli_query($link, $sql);
    if ($row = mysqli_fetch_array($result)) {
        $respuesta = "OC";
        return $respuesta;
    } else {
        $respuesta = "DESOCUPADO";
        return $respuesta;
    }
}

function buscarNitPlanta($nit)
{
    include('../config.php');
    $sql = "SELECT nit 
            FROM beneficio 
            WHERE nit = '" . $nit . "'";
    $result = mysqli_query($link, $sql);
    if ($row = mysqli_fetch_array($result)) {
        $respuesta = "OC";
        return $respuesta;
    } else {
        $respuesta = "DESOCUPADO";
        return $respuesta;
    }
}

function buscarNitProveedorPollo($nit)
{
    include('../config.php');
    $sql = "SELECT nit 
            FROM proveedorpollo 
            WHERE nit = '" . $nit . "'";
    $result = mysqli_query($link, $sql);
    if ($row = mysqli_fetch_array($result)) {
        $respuesta = "OC";
        return $respuesta;
    } else {
        $respuesta = "DESOCUPADO";
        return $respuesta;
    }
}

function buscarItem($item)
{
    include('../config.php');
    $sql = "SELECT item 
            FROM plantilla 
            WHERE item = '" . $item . "'";
    $result = mysqli_query($link, $sql);
    if ($row = mysqli_fetch_array($result)) {
        $respuesta = "OC";
        return $respuesta;
    } else {
        $respuesta = "DESOCUPADO";
        return $respuesta;
    }
}

function buscarCodigo($codigo)
{
    include('../config.php');
    $sql = "SELECT codigo 
            FROM plantilla 
            WHERE codigo = '" . $codigo . "'";
    $result = mysqli_query($link, $sql);
    if ($row = mysqli_fetch_array($result)) {
        $respuesta = "OC";
        return $respuesta;
    } else {
        $respuesta = "DESOCUPADO";
        return $respuesta;
    }
}

function buscarCedulaResponsable($cedula)
{
    include('../config.php');
    $sql = "SELECT cedula 
            FROM responsables 
            WHERE cedula = '" . $cedula . "'";
    $result = mysqli_query($link, $sql);
    if ($row = mysqli_fetch_array($result)) {
        $respuesta = "OC";
        return $respuesta;
    } else {
        $respuesta = "DESOCUPADO";
        return $respuesta;
    }
}

function buscarPlacaD($cedula)
{
    include('../config.php');
    $sql = "SELECT placa 
            FROM placas 
            WHERE placa = '" . $cedula . "'";
    $result = mysqli_query($link, $sql);
    if ($row = mysqli_fetch_array($result)) {
        $respuesta = "OC";
        return $respuesta;
    } else {
        $respuesta = "DESOCUPADO";
        return $respuesta;
    }
}

function buscarCedulaConductor($cedula)
{
    include('../config.php');
    $sql = "SELECT cedula 
            FROM conductores 
            WHERE cedula = '" . $cedula . "'";
    $result = mysqli_query($link, $sql);
    if ($row = mysqli_fetch_array($result)) {
        $respuesta = "OC";
        return $respuesta;
    } else {
        $respuesta = "DESOCUPADO";
        return $respuesta;
    }
}

function buscarPlaca($datosPlacaR)
{
    include('../config.php');
    $sql = "SELECT placa 
            FROM placas_recepcion 
            WHERE placa = '" . $datosPlacaR['placa'] . "'";
    $result = mysqli_query($link, $sql);
    if ($row = mysqli_fetch_array($result)) {
        $respuesta = "OC";
        return $respuesta;
    } else {
        return agregarPlacaRecepcion($datosPlacaR);
    }
}

function buscarPlacaPollo($datosPlacaR)
{
    include('../config.php');
    $sql = "SELECT placa 
            FROM placas_recepcion_pollo 
            WHERE placa = '" . $datosPlacaR['placa'] . "'";
    $result = mysqli_query($link, $sql);
    if ($row = mysqli_fetch_array($result)) {
        $respuesta = "OC";
        return $respuesta;
    } else {
        return agregarPlacaRecepcionPollo($datosPlacaR);
    }
}

function agregarConductorRecepcion($datosConductor)
{
    include('../config.php');
    $sql = " INSERT INTO conductores_recepcion(cedula,nombres) 
    VALUES (
        '" . $datosConductor['cedula'] . "',
        '" . $datosConductor['nombresConductor'] . "'
        );";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $listaConductores_recepcion = listaConductores_recepcion_registro();
        return json_encode($listaConductores_recepcion);
    }
}

function agregarConductorRecepcionPollo($datosConductor)
{
    include('../config.php');
    $sql = " INSERT INTO conductores_recepcion_pollo(cedula,nombres) 
    VALUES (
        '" . $datosConductor['cedula'] . "',
        '" . $datosConductor['nombresConductor'] . "'
        );";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $listaConductores_recepcion = listaConductores_recepcion_registro_pollo();
        return json_encode($listaConductores_recepcion);
    }
}

function agregarPlacaRecepcion($datosPlacaR)
{
    include('../config.php');
    $sql = " INSERT INTO placas_recepcion(placa) 
    VALUES ('" . $datosPlacaR['placa'] . "');";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $listaPlacas_recepcion = listaPlacas_recepcion_registro();
        return json_encode($listaPlacas_recepcion);
    }
}

function agregarPlacaRecepcionPollo($datosPlacaR)
{
    include('../config.php');
    $sql = " INSERT INTO placas_recepcion_pollo(placa) 
    VALUES ('" . $datosPlacaR['placa'] . "');";
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $listaPlacas_recepcion = listaPlacas_recepcion_registro_pollo();
        return json_encode($listaPlacas_recepcion);
    }
}

function calcularDiferencia($datosPesoRecepcion)
{
    include('../config.php');
    $diferencia = $datosPesoRecepcion['total'] - $datosPesoRecepcion['peso'];
    
    $porcentaje_cambio = number_format((($diferencia / $datosPesoRecepcion['total']) * 100), 2, '.', '');
    if ($datosPesoRecepcion['peso'] < $datosPesoRecepcion['total']) {
        $tipodiferencia = 'POSITIVA';
    } else {
        $tipodiferencia = 'NEGATIVA';
    }
    $sql = "UPDATE recepcion_pesos set 
              inventario = '" . $datosPesoRecepcion['peso'] . "',
              diferencia = '" . $porcentaje_cambio . "',
              diferenciaPeso = '" . $diferencia . "',
              tipodiferencia  = '" . $tipodiferencia . "'
              where id_recepcion_pesos = '" . $datosPesoRecepcion['id_recepcion_peso'] . "'";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $sql;
    }
}

function eliminarCalculoDiferencia($datosEPesoRecepcion)
{
    include('../config.php');

    $sql = "UPDATE recepcion_pesos set 
              inventario = '',
              diferencia = '',
              tipodiferencia  = ''
              where id_recepcion_pesos = '" . $datosEPesoRecepcion['id_recepcion_peso'] . "'";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $sql;
    }
}

function guardar_destino($data){
    include('../config.php');
    $sql = "INSERT INTO destinos(empresa,sede,direccion,municipio,status)
        VALUES(
            '".$data["empresa"]."',
            '".$data["sede"]."',
            '".$data["direccion"]."',
            '".$data["municipio"]."',
            '".$data["status"]."'
        )";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function traer_destino($id){
    include('../config.php');

    $sql = "SELECT empresa,sede,direccion,municipio,status FROM destinos WHERE id = '$id'";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        mysqli_free_result($rs_operacion);
        return $items;
    }
}

function editar_destino($data){
    include('../config.php');

    $sql = "UPDATE destinos SET
        empresa = '".$data["empresa"]."',
        sede = '".$data["sede"]."',
        direccion = '".$data["direccion"]."',
        municipio = '".$data["municipio"]."',
        status = '".$data["status"]."'
        WHERE id = '".$data["id"]."'";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return mysqli_error($link);
    } else {
        return $data["id"];
    }
}

function bloquear_guia(){
    include('../config.php');

    $sql = "SELECT id_recepcion FROM recepcionpollo ORDER BY id_recepcion DESC LIMIT 1";
    $id_guia = mysqli_fetch_row(mysqli_query($link, $sql));
    $sql2 = "SELECT proveedor FROM recepcion_pesos_pollo WHERE proveedor = '$id_guia[0]'";
    if (mysqli_num_rows(mysqli_query($link, $sql2)) > 0) {
        return "si hay lote";
    }else {
        return "no hay lote";
    }

}

function bloquear_guiaCarne(){
    include('../config.php');

    $sql = "SELECT id_recepcion FROM recepcion ORDER BY id_recepcion DESC LIMIT 1";
    $id_guia = mysqli_fetch_row(mysqli_query($link, $sql));
    $sql2 = "SELECT id_recepcion FROM recepcion_pesos WHERE id_recepcion = '$id_guia[0]'";
    if (mysqli_num_rows(mysqli_query($link, $sql2)) > 0) {
        return "si hay lote";
    }else {
        return "no hay lote";
    }

}

function bloquear_guia_despacho(){
    include('../config.php');

    $sql = "SELECT id_guia FROM guias ORDER BY id_guia DESC LIMIT 1";
    $id_guia = mysqli_fetch_row(mysqli_query($link, $sql));
    $sql2 = "SELECT proveedor FROM item_proveedor WHERE proveedor = '$id_guia[0]'";
    if (mysqli_num_rows(mysqli_query($link, $sql2)) > 0) {
        return "si hay lote";
    }else {
        return "no hay lote";
    }

}

function bloquear_guia_despacho_pollo(){
    include('../config.php');

    $sql = "SELECT id_guia FROM guiaspollo ORDER BY id_guia DESC LIMIT 1";
    $id_guia = mysqli_fetch_row(mysqli_query($link, $sql));
    $sql2 = "SELECT proveedor FROM item_proveedorpollo WHERE proveedor = '$id_guia[0]'";
    if (mysqli_num_rows(mysqli_query($link, $sql2)) > 0) {
        return "si hay lote";
    }else {
        return "no hay lote";
    }

}

function borrarfoto($data){
    include('../config.php');

    $archivo = "../controlador/recepcion pollo/".$data;
    if (file_exists($archivo)) {
        if (unlink($archivo)) {
            return "El archivo se ha eliminado correctamente.";
        }else{
            return "El archivo no se ha eliminado correctamente.";
        }
    }else{
        return "El archivo no se ha encontrado.";
    }
}

function agregarNuevoConductorR($datos) {
    include('../config.php');
    $sql = " INSERT INTO conductores_recepcion(cedula,nombres,telefono,status) 
    VALUES (
        '" . $datos['cedula'] . "',
        '" . $datos['nombres'] . "',
        '" . $datos['telefono'] . "',
        '" . $datos['status'] . "'
        );";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function cargarConductoresR($id) {
    include('../config.php');
    $sql = "SELECT cedula,
        nombres,
        telefono,
        status,
        id
    FROM 
        conductores_recepcion
    WHERE
        id=" . $id;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function editarConductoresR($info) {
    include('../config.php');

    $sql = "UPDATE conductores_recepcion set 
            cedula = '" . $info['cedula'] . "',
            nombres ='" . $info['nombres'] . "',
            telefono='" . $info['telefono'] . "',
            status='" . $info['status'] . "'
            where id = " . $info['id'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        //return mysqli_error($link);
        return $sql;
    } else {
        return $info['id'];
    }
}

function buscarCedulaConductorR($cedula) {
    include('../config.php');
    $sql = "SELECT cedula 
            FROM conductores_recepcion 
            WHERE cedula = '" . $cedula . "'";

    $result = mysqli_query($link, $sql);
    if ($row = mysqli_fetch_array($result)) {
        $respuesta = "OC";
        return $respuesta;
    } else {
        $respuesta = "DESOCUPADO";
        return $respuesta;
    }
}

function eliminar_conductorR($id){
    include('../config.php');

    $sql = "DELETE FROM conductores_recepcion WHERE id = " . $id;

    $rs_operacion = mysqli_query($link,$sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return $id;
    }
}

function eliminar_conductorD($id){
    include('../config.php');

    $sql = "DELETE FROM conductores_recepcion_pollo WHERE id = " . $id;

    $rs_operacion = mysqli_query($link,$sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return $id;
    }
}

function agregarNuevoConductorP($datos) {
    include('../config.php');

    $sql = " INSERT INTO conductores_recepcion_pollo(cedula,nombres,telefono,status) 
    VALUES (
        '" . $datos['cedula'] . "',
        '" . $datos['nombres'] . "',
        '" . $datos['telefono'] . "',
        '" . $datos['status'] . "'
        );";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function cargarConductoresP($id) {
    include('../config.php');
    $sql = "SELECT cedula,
        nombres,
        telefono,
        status,
        id
    FROM 
        conductores_recepcion_pollo
    WHERE
        id=" . $id;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_assoc($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function editarConductoresP($info) {
    include('../config.php');

    $sql = "UPDATE conductores_recepcion_pollo set 
            cedula = '" . $info['cedula'] . "',
            nombres ='" . $info['nombres'] . "',
            telefono='" . $info['telefono'] . "',
            status='" . $info['status'] . "'
            where id = " . $info['id'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        //return mysqli_error($link);
        return $sql;
    } else {
        return $info['id'];
    }
}

function buscarCedulaConductorP($cedula) {
    include('../config.php');
    $sql = "SELECT cedula 
            FROM conductores_recepcion_pollo 
            WHERE cedula = '" . $cedula . "'";

    $result = mysqli_query($link, $sql);
    if ($row = mysqli_fetch_array($result)) {
        $respuesta = "OC";
        return $respuesta;
    } else {
        $respuesta = "DESOCUPADO";
        return $respuesta;
    }
}

function agregar_guia_desprese($datos) {
    include('../config.php');

    /* if ($datos["proveedorP"] == "0") {
        $datos["proveedorP"] = $datos["proveedorPEnt"];
    }elseif ($datos["proveedorPEnt"] == "0") {
        $datos["proveedorPEnt"] = $datos["proveedorP"];
    }

    if ($datos["lotePollo"] == "") {
        $datos["lotePollo"] = $datos["lotePolloEnt"];
    }elseif ($datos["lotePolloEnt"] == "") {
        $datos["lotePolloEnt"] = $datos["lotePollo"];
    }

    if ($datos["fechaBeneficio"] == "") {
        $datos["fechaBeneficio"] = $datos["fechaBeneficioEnt"];
    }elseif ($datos["fechaBeneficioEnt"] == "") {
        $datos["fechaBeneficioEnt"] = $datos["fechaBeneficio"];
    }

    if ($datos["fechaPollo"] == "") {
        $datos["fechaPollo"] = $datos["fechaPolloEnt"];
    }elseif ($datos["fechaPolloEnt"] == "") {
        $datos["fechaPolloEnt"] = $datos["fechaPollo"];
    } */

    $sql = " INSERT INTO desprese(
        destino,
        proveedor_pollo,
        lote_pollo,
        fecha_venci_pollo,
        responsable,
        fecha_beneficio,
        tipo_pollo,
        proveedor_pollo_entero,
        lote_pollo_entero,
        fecha_beneficio_entero,
        fecha_venci_pollo_entero,
        fecha_registro
    ) 
    VALUES (
        '" .$datos["sede"]. "',
        '" .$datos["proveedorP"]. "',
        '" .$datos["lotePollo"]. "',
        '" .$datos["fechaPollo"]. "',
        '" .$datos["responsable"]. "',
        '" .$datos["fechaBeneficio"]. "',
        '" .$datos["tipoP"]. "',
        '" .$datos["proveedorPEnt"]. "',
        '" .$datos["lotePolloEnt"]. "',
        '" .$datos["fechaBeneficioEnt"]. "',
        '" .$datos["fechaPolloEnt"]. "',
        '" .$datos["fechaRegistro"]. "'
    )";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function buscar_desprese($id) {
    include('../config.php');
    $sql = "SELECT 
        destino,
        proveedor_pollo,
        lote_pollo,
        fecha_venci_pollo,
        responsable,
        fecha_beneficio,
        tipo_pollo,
        proveedor_pollo_entero,
        lote_pollo_entero,
        fecha_beneficio_entero,
        fecha_venci_pollo_entero,
        fecha_registro
    FROM 
        desprese
    WHERE
        id=" . $id;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function editar_guia_desprese($datos) {
    include('../config.php');

    $sql = "UPDATE desprese set 
        destino = '" . $datos['sede'] . "',
        proveedor_pollo = '" . $datos['proveedorP'] . "',
        lote_pollo = '" . $datos['lotePollo'] . "',
        fecha_venci_pollo = '" . $datos['fechaPollo'] . "',
        responsable = '" . $datos['responsable'] . "',
        fecha_beneficio = '" . $datos['fechaBeneficio'] . "',
        tipo_pollo = '" . $datos['tipoP'] . "',
        proveedor_pollo_entero = '" . $datos['proveedorPEnt'] . "',
        lote_pollo_entero = '" . $datos['lotePolloEnt'] . "',
        fecha_beneficio_entero = '" . $datos['fechaBeneficioEnt'] . "',
        fecha_venci_pollo_entero = '" . $datos['fechaPolloEnt'] . "',
        fecha_registro = '" . $datos['fechaRegistro'] . "'
        where id = " . $datos['idDesprese'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        //return mysqli_error($link);
        return $sql;
    } else {
        return $datos['idDesprese'];
    }
}

function agregar_proveedor_hielo($datos) {
    include('../config.php');

    $sql = " INSERT INTO proveedor_hielo(
        nit,
        sede,
        direccion,
        municipio,
        status
    ) 
    VALUES (
        '" .$datos["nit"]. "',
        '" .$datos["razon"]. "',
        '" .$datos["direccion"]. "',
        '" .$datos["municipio"]. "',
        '" .$datos["status"]. "'
    )";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function cargar_proveedor_hielo($id){
    include('../config.php');
    $sql = "SELECT 
        nit,
        sede,
        direccion,
        municipio,
        status
    FROM 
        proveedor_hielo
    WHERE
        id=" . $id;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function editar_proveedor_hielo($datos) {
    include('../config.php');

    $sql = "UPDATE proveedor_hielo set 
        nit = '" . $datos['nit'] . "',
        sede = '" . $datos['razon'] . "',
        direccion = '" . $datos['direccion'] . "',
        municipio = '" . $datos['municipio'] . "',
        status = '" . $datos['status'] . "'
        where id = " . $datos['id'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        //return mysqli_error($link);
        return $sql;
    } else {
        return $datos['id'];
    }
}

function buscarNitProveedorHielo($nit) {
    include('../config.php');
    $sql = "SELECT nit 
            FROM proveedor_hielo 
            WHERE nit = '" . $nit . "'";
    $result = mysqli_query($link, $sql);
    if ($row = mysqli_fetch_array($result)) {
        $respuesta = "OC";
        return $respuesta;
    } else {
        $respuesta = "DESOCUPADO";
        return $respuesta;
    }
}

function agregar_proveedor_salmuera($datos) {
    include('../config.php');

    $sql = " INSERT INTO proveedor_salmuera(
        nit,
        sede,
        direccion,
        municipio,
        status
    ) 
    VALUES (
        '" .$datos["nit"]. "',
        '" .$datos["razon"]. "',
        '" .$datos["direccion"]. "',
        '" .$datos["municipio"]. "',
        '" .$datos["status"]. "'
    )";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function cargar_proveedor_salmuera($id){
    include('../config.php');
    $sql = "SELECT 
        nit,
        sede,
        direccion,
        municipio,
        status
    FROM 
        proveedor_salmuera
    WHERE
        id=" . $id;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function editar_proveedor_salmuera($datos) {
    include('../config.php');

    $sql = "UPDATE proveedor_salmuera set 
        nit = '" . $datos['nit'] . "',
        sede = '" . $datos['razon'] . "',
        direccion = '" . $datos['direccion'] . "',
        municipio = '" . $datos['municipio'] . "',
        status = '" . $datos['status'] . "'
        where id = " . $datos['id'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        //return mysqli_error($link);
        return $sql;
    } else {
        return $datos['id'];
    }
}

function buscarNitProveedorSalmuera($nit) {
    include('../config.php');
    $sql = "SELECT nit 
            FROM proveedor_salmuera 
            WHERE nit = '" . $nit . "'";
    $result = mysqli_query($link, $sql);
    if ($row = mysqli_fetch_array($result)) {
        $respuesta = "OC";
        return $respuesta;
    } else {
        $respuesta = "DESOCUPADO";
        return $respuesta;
    }
}

function agregar_proveedor_empaque($datos) {
    include('../config.php');

    $sql = " INSERT INTO proveedor_empaque(
        nit,
        sede,
        direccion,
        municipio,
        status
    ) 
    VALUES (
        '" .$datos["nit"]. "',
        '" .$datos["razon"]. "',
        '" .$datos["direccion"]. "',
        '" .$datos["municipio"]. "',
        '" .$datos["status"]. "'
    )";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function cargar_proveedor_empaque($id){
    include('../config.php');
    $sql = "SELECT 
        nit,
        sede,
        direccion,
        municipio,
        status
    FROM 
        proveedor_empaque
    WHERE
        id=" . $id;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function editar_proveedor_empaque($datos) {
    include('../config.php');

    $sql = "UPDATE proveedor_empaque set 
        nit = '" . $datos['nit'] . "',
        sede = '" . $datos['razon'] . "',
        direccion = '" . $datos['direccion'] . "',
        municipio = '" . $datos['municipio'] . "',
        status = '" . $datos['status'] . "'
        where id = " . $datos['id'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        //return mysqli_error($link);
        return $sql;
    } else {
        return $datos['id'];
    }
}

function buscarNitProveedorEmpaque($nit) {
    include('../config.php');
    $sql = "SELECT nit 
            FROM proveedor_empaque 
            WHERE nit = '" . $nit . "'";
    $result = mysqli_query($link, $sql);
    if ($row = mysqli_fetch_array($result)) {
        $respuesta = "OC";
        return $respuesta;
    } else {
        $respuesta = "DESOCUPADO";
        return $respuesta;
    }
}

function agregar_fabricante_empaque($datos) {
    include('../config.php');

    $sql = " INSERT INTO fabricante_empaque(
        nit,
        sede,
        direccion,
        municipio,
        status
    ) 
    VALUES (
        '" .$datos["nit"]. "',
        '" .$datos["razon"]. "',
        '" .$datos["direccion"]. "',
        '" .$datos["municipio"]. "',
        '" .$datos["status"]. "'
    )";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function cargar_fabricante_empaque($id){
    include('../config.php');
    $sql = "SELECT 
        nit,
        sede,
        direccion,
        municipio,
        status
    FROM 
        fabricante_empaque
    WHERE
        id=" . $id;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function editar_fabricante_empaque($datos) {
    include('../config.php');

    $sql = "UPDATE fabricante_empaque set 
        nit = '" . $datos['nit'] . "',
        sede = '" . $datos['razon'] . "',
        direccion = '" . $datos['direccion'] . "',
        municipio = '" . $datos['municipio'] . "',
        status = '" . $datos['status'] . "'
        where id = " . $datos['id'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        //return mysqli_error($link);
        return $sql;
    } else {
        return $datos['id'];
    }
}

function buscarNitFabricanteEmpaque($nit) {
    include('../config.php');
    $sql = "SELECT nit 
            FROM fabricante_empaque 
            WHERE nit = '" . $nit . "'";
    $result = mysqli_query($link, $sql);
    if ($row = mysqli_fetch_array($result)) {
        $respuesta = "OC";
        return $respuesta;
    } else {
        $respuesta = "DESOCUPADO";
        return $respuesta;
    }
}

function listaProveedoresHielo(){
    include('./config.php');
    $sql = "SELECT id,nit,sede FROM proveedor_hielo WHERE status = 'ACTIVO'";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta hielo: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function listaProveedoresEmpaque(){
    include('./config.php');
    $sql = "SELECT id,nit,sede FROM proveedor_empaque WHERE status = 'ACTIVO'";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta empaque: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }

}

function listaProveedoresSalmuera(){
    include('./config.php');
    $sql = "SELECT id,nit,sede FROM proveedor_salmuera WHERE status = 'ACTIVO'";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta salmuera: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }

}

function listaFabricantesEmpaque(){
    include('./config.php');
    $sql = "SELECT id,nit,sede FROM fabricante_empaque WHERE status = 'ACTIVO'";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta fabricante: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }

}

function itemsDesprese(){
    include('./config.php');

    $sql = "SELECT item,descripcion FROM plantilla WHERE 
        status = 'ACTIVO' AND 
        item = '059758' OR 
        item = '045401' OR 
        item = '042788' OR 
        item = '042789' OR 
        item = '059756' OR 
        item = '059757' OR 
        item = '059755' OR
        item = '059762' OR
        item = '059761' OR
        item = '059760' OR
        item = '059759'
        ORDER BY descripcion ASC
    ";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta items: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function agregar_desprese_item($datos) {
    include('../config.php');

    $sql2 = "UPDATE desprese SET dia_desprese = '".date("w-W")."', fecha_desprese = '".date("Y-m-d")."' WHERE id =" . $datos["idGuia"];
    mysqli_query($link, $sql2);

    $sql = " INSERT INTO desprese_items(
        guia,
        item,
        kilos,
        cajas,
        canastilla_base
    ) 
    VALUES (
        '" .$datos["guia"]. "',
        '" .$datos["item"]. "',
        '" .$datos["kilos"]. "',
        '" .$datos["cajas"]. "',
        '" .$datos["canastillaBase"]. "'
    )";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}


function traer_item($id){
    include('../config.php');
    $sql = "SELECT
        kilos,
        cajas,
        canastilla_base
        FROM desprese_items 
        WHERE id_item_desprese = " . $id;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta fabricante: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }

}

function editar_item($datos) {
    include('../config.php');

    $sql = "UPDATE desprese_items SET 
        kilos = '" . $datos['kilosDesprese'] . "',
        cajas = '" . $datos['cajasDesprese'] . "',
        canastilla_base = '" . $datos['canastillaBase'] . "'
        where id_item_desprese = " . $datos['id_item'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return $sql;
    } else {
        return $datos['id_item'];
    }
}

function eliminar_Item($id) {
    include('../config.php');

    $sql = " DELETE FROM desprese_items WHERE id_item_desprese = " . $id;
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return $id;
    }
}

function agregar_mejora($datos) {
    include('../config.php');

    $sql2 = "SELECT responsable2 FROM desprese WHERE id = " . $datos["idGuia"];
    $rs_operacion2 = mysqli_query($link, $sql2);
    $row = mysqli_fetch_row($rs_operacion2);
    if ($row[0] == 0) {
        $sql2 = "UPDATE desprese SET responsable2 = '".$datos["responsable"]."' WHERE id = '".$datos["idGuia"]."' ";
        $rs_operacion2 = mysqli_query($link, $sql2);
    }

    $sql = " INSERT INTO mejora_items(
        id_guia,
        item,
        kilos_mejora,
        cajas_mejora,
        responsable,
        lote,
        cajas_mejora_base
    ) 
    VALUES (
        '" .$datos["idGuia"]. "',
        '" .$datos["item"]. "',
        '" .$datos["kilos_mejora"]. "',
        '" .$datos["cajas_mejora"]. "',
        '" .$datos["responsable"]. "',
        '" .$datos["lote"]. "',
        '" .$datos["cajas_base"]. "'
    )";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function traer_mejora($id) {
    include('../config.php');
    $sql = "SELECT 
        item,
        kilos_mejora,
        cajas_mejora,
        id,
        responsable,
        lote,
        cajas_mejora_base
        FROM mejora_items 
        WHERE id = " . $id;

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function editar_mejora($datos) {
    include('../config.php');

    $sql = "UPDATE mejora_items SET
        item = '" .$datos["item"]. "',
        kilos_mejora = '" . $datos['kilos_mejora'] . "',
        cajas_mejora = '" . $datos['cajas_mejora'] . "',
        responsable = '" . $datos['responsable'] . "',
        lote = '" . $datos['lote'] . "',
        cajas_mejora_base = '" . $datos['cajas_base'] . "'
        WHERE id = " . $datos['idItem'];

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return $sql;
    } else {
        return $datos['idItem'];
    }
}

function eliminar_Mejora($id) {
    include('../config.php');

    $sql = " DELETE FROM mejora_items WHERE id = " . $id;
    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return $id;
    }
}


function verificar_item($id){
    include('../config.php');

    $sql = "SELECT item FROM desprese_items WHERE guia = $id GROUP BY item";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function traer_dias($datos){
    include('../config.php');

    if ($datos["item"] == "POLLO CAMPO MERCAMIO MARINADO" || $datos["item"] == "POLLO BLANCO MERCAMIO MARINADO") {
        $sql = "SELECT 
            dia_desprese,
            proveedorpollo.siglas
            FROM desprese 
            INNER JOIN
                proveedorpollo ON desprese.proveedor_pollo_entero = proveedorpollo.id
            WHERE desprese.id = $datos[idMejora]";
    }else {
        $sql = "SELECT 
            dia_desprese,
            proveedorpollo.siglas
            FROM desprese 
            INNER JOIN
                proveedorpollo ON desprese.proveedor_pollo = proveedorpollo.id
            WHERE desprese.id = $datos[idMejora]";
    }

    

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function agregar_temps($datos){
    include('../config.php');

    if ($datos["temp1"] != "" && $datos["hora1"] != "") {
        if ($datos["temp2"] != "" && $datos["hora2"] != "") {
            if ($datos["temp3"] != "" && $datos["hora3"] == "") {
                $datos["hora3"] = date("g:i A");
            }
        }else {
            $datos["hora2"] = date("g:i A");
        }
    }else {
        $datos["hora1"] = date("g:i A");
    }

    $sql = "UPDATE desprese SET
        Temp1 = '$datos[temp1]',
        Temp2 = '$datos[temp2]',
        Temp3 = '$datos[temp3]',
        Hora1 = '$datos[hora1]',
        Hora2 = '$datos[hora2]',
        Hora3 = '$datos[hora3]'
        WHERE id = $datos[id]
    ";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return $sql;
    } else {
        return $datos["id"];
    }
}

function agregar_item_canal($datos){
    include('../config.php');

    if ($datos["select"] == "NECESIDAD") {
        $datos["nececidad"] = $datos["valor"];
        $datos["sobrante"] = "";
    }else {
        $datos["nececidad"] = "";
        $datos["sobrante"] = $datos["valor"];
    }

    $sql2 = "SELECT * FROM items_canal WHERE canal = '".$datos["canal"]."' AND item = '".$datos["item"]."'";
    $rs2 = mysqli_query($link, $sql2);

    if (mysqli_num_rows($rs2) > 0) {
        $sql3 = "UPDATE items_canal SET
            sede = '".$datos["sede"]."',
            canal = '".$datos["canal"]."',
            item = '".$datos["item"]."',
            nececidad = '".$datos["nececidad"]."',
            sobrante = '".$datos["sobrante"]."'
            WHERE canal = '".$datos["canal"]."' AND item = '".$datos["item"]."'";

        $rs_operation3 = mysqli_query($link, $sql3);

        if (!$rs_operation3) {
            echo "Error al ejecutar la consulta: " . mysqli_error($link);
            exit();
        } else {
            return array("status" => "success", "canal" => $datos["canal"], "item" => $datos["item"]);
        }
    }else {
        $sql = "INSERT INTO items_canal(
            sede,
            canal,
            item,
            nececidad,
            sobrante
        )
        VALUES(
            '".$datos["sede"]."',
            '".$datos["canal"]."',
            '".$datos["item"]."',
            '".$datos["nececidad"]."',
            '".$datos["sobrante"]."'
        )
        ";
    
        $rs_operation = mysqli_query($link, $sql);
    
        if (!$rs_operation) {
            return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
        } else {
            return array("status" => "success", "id" => mysqli_insert_id($link));
        }
    }
}

function agregar_canal($datos){
    include('../config.php');

    $sql1 = "SELECT semana FROM semana WHERE status = 'ACTIVO'";
    $rs1 = mysqli_query($link, $sql1);
    $semana = mysqli_fetch_row($rs1);

    if ($datos["especie"] == "RES") {
        $sql2 = "SELECT * FROM programacioncanales WHERE especie = 'RES' AND sede = '".$datos["sede"]."' AND semana = " . $semana[0];
        $rs2 = mysqli_query($link, $sql2);
        if (mysqli_num_rows($rs2) == 1) {
            return array("status" => "error", "message" => "Ya existe un canal para la especie RES", "type" => "RES");
        }
    }else {
        $sql2 = "SELECT * FROM programacioncanales WHERE especie = 'CERDO' AND sede = '".$datos["sede"]."' AND semana = " . $semana[0];
        $rs2 = mysqli_query($link, $sql2);
        if (mysqli_num_rows($rs2) == 1) {
            return array("status" => "error", "message" => "Ya existe un canal para la especie CERDO", "type" => "CERDO");
        }
    }

    $sql = "INSERT INTO programacioncanales(
        sede,
        semana,
        fecha_inicio,
        fecha_fin,
        especie,
        cantidad
    )
    VALUE(
        '".$datos["sede"]."',
        '".$datos["semana"]."',
        '".$datos["fecha_inicio"]."',
        '".$datos["fechaFin"]."',
        '".$datos["especie"]."',
        '".$datos["cantidad"]."'
    )";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function traer_canal($id){
    include('../config.php');

    $sql = "SELECT 
        sede,
        semana,
        fecha_inicio,
        fecha_fin,
        especie,
        cantidad
        FROM programacioncanales WHERE id = '$id'";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }
}

function editar_canal($datos){
    include('../config.php');

    $sql = "UPDATE programacioncanales SET
        sede = '".$datos["sede"]."',
        semana = '".$datos["semana"]."',
        fecha_inicio = '".$datos["fecha_inicio"]."',
        fecha_fin = '".$datos["fechaFin"]."',
        especie = '".$datos["especie"]."',
        cantidad = '".$datos["cantidad"]."'
        WHERE id = '".$datos["id"]."'
    ";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return $sql;
    } else {
        return $datos["id"];
    }
}

function bloquear_canal($id){
    include('../config.php');

    $sql = "UPDATE programacioncanales SET status = '0' WHERE id = '$id'";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => $id);
    }
}

function desbloquear_canal($id){
    include('../config.php');

    $sql = "UPDATE programacioncanales SET status = '1' WHERE id = '$id'";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => $id);
    }
}

function traer_temps($id){
    include('../config.php');

    $sql = "SELECT Temp1, Temp2, Temp3, Hora1, Hora2, Hora3 FROM desprese WHERE id = '$id'";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operation)) {
            $items[] = $row;
        }
        return $items;
    }
}

function agregar_ciudad($datos){
    include('../config.php');

    $sql = "INSERT INTO municipios(
        descripcion,
        status
    )
    VALUE(
        '".$datos["ciudadMunicipio"]."',
        '".$datos["status"]."'
    )";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function traer_ciudad($id){
    include('../config.php');

    $sql = "SELECT 
        descripcion,
        status 
        FROM municipios WHERE id = '$id'";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operation)) {
            $items[] = $row;
        }
        return $items;
    }
}

function editar_ciudad($datos){
    include('../config.php');

    $sql = "UPDATE municipios SET descripcion = '".$datos["ciudadMunicipio"]."', status = '".$datos["status"]."' WHERE id = '$datos[id]'";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => $datos["id"]);
    }
}

function elminar_cuidad($id){
    include('../config.php');

    $sql = "DELETE FROM municipios WHERE id = '$id'";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => $id);
    }
}

function items_desprese($id) {
    include('../config.php');

    $sql = "SELECT tipo_pollo FROM desprese WHERE id = '$id'";
    $rs_operation = mysqli_query($link, $sql);
    $tipoPollo = mysqli_fetch_row($rs_operation);

    if ($tipoPollo[0] == "BLANCO") {
        $sql2 = "SELECT 
        item 
        FROM plantilla 
        WHERE item = '059762' OR
        item = '059760' OR
        item = '059761' OR
        item = '042789' OR
        item = '045401' OR
        item = '042788'
        ";
        /* "OR
        item = '059759'" */
    }else {
        $sql2 = "SELECT 
        item 
        FROM plantilla 
        WHERE item = '059758' OR
        item = '059756' OR
        item = '059757' OR
        item = '042789' OR
        item = '045401' OR
        item = '042788'
        ";

        /* OR
        item = '059755' */ 
    }

    $rs_operation2 = mysqli_query($link, $sql2);
    
    if (!$rs_operation2) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operation2)) {
            $items[] = $row[0];
        }
        return $items;
    }
}

function agregar_year($datos){
    include('../config.php');

    if ($datos["status"] == "ACTIVO") {
        $sql2 = "UPDATE year SET status = 'INACTIVO'";
        mysqli_query($link, $sql2);
    }

    $sql = "INSERT INTO year(
        year,
        status
    )
    VALUE(
        '".$datos["year"]."',
        '".$datos["status"]."'
    )";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function traer_year($id){
    include('../config.php');

    $sql = "SELECT 
        year,
        status 
        FROM year WHERE id = '$id'";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operation)) {
            $items[] = $row;
        }
        return $items;
    }
}

function editar_year($datos){
    include('../config.php');

    if ($datos["status"] == "ACTIVO") {
        $sql2 = "UPDATE year SET status = 'INACTIVO'";
        mysqli_query($link, $sql2);
    }

    $sql = "UPDATE year SET year = '".$datos["year"]."', status = '".$datos["status"]."' WHERE id = '$datos[id]'";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => $datos["id"]);
    }
}

function agregar_semana($datos){
    include('../config.php');

    if ($datos["status"] == "ACTIVO") {
        $sql2 = "UPDATE semana SET status = 'INACTIVO'";
        mysqli_query($link, $sql2);
    }

    $sql = "INSERT INTO semana(
        year,
        semana,
        fecha_inicio,
        fecha_fin,
        status
    )
    VALUE(
        '".$datos["year"]."',
        '".$datos["semana"]."',
        '".$datos["fecha_inicio"]."',
        '".$datos["fecha_fin"]."',
        '".$datos["status"]."'
    )";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function traer_semana($id){
    include('../config.php');

    $sql = "SELECT 
        year,
        semana,
        fecha_inicio,
        fecha_fin,
        status
        FROM semana WHERE id = '$id'";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operation)) {
            $items[] = $row;
        }
        return $items;
    }
}

function editar_Semana($datos){
    include('../config.php');

    if ($datos["status"] == "ACTIVO") {
        $sql2 = "UPDATE semana SET status = 'INACTIVO'";
        mysqli_query($link, $sql2);
    }

    $sql = "UPDATE semana SET 
        year = '".$datos["year"]."', 
        semana = '".$datos["semana"]."', 
        fecha_inicio = '".$datos["fecha_inicio"]."', 
        fecha_fin = '".$datos["fecha_fin"]."', 
        status = '".$datos["status"]."' 
        WHERE id = '$datos[id]'";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => $datos["id"]);
    }
}

function Years(){
    include('./config.php');

    $sql = "SELECT year FROM year WHERE status = 'ACTIVO'";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operation)) {
            $items[] = $row;
        }
        return $items;
    }
}

function semana_activa(){
    include('../config.php');

    $sql = "SELECT * FROM semana WHERE status = 'ACTIVO'";
    $rs_operation = mysqli_query($link, $sql);

    if (mysqli_num_rows($rs_operation) > 0) {
        $rows = array();
        while ($row = mysqli_fetch_assoc($rs_operation)) {
            $rows[] = $row;
        }
        return $rows;
    } else {
        return array("status" => "error", "message" => "No hay semanas activas");
    }
}

function bloquear_desprese($id){
    include('../config.php');

    $sql = "UPDATE desprese SET status = '0' WHERE id = '$id'";
    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return array("status" => "success", "id" => $id);
    }
}


function desbloquear_desprese($id){
    include('../config.php');

    $sql = "UPDATE desprese SET status = '1' WHERE id = '$id'";
    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return array("status" => "success", "id" => $id);
    }
}

function items_canal($id){
    include('../config.php');

    $sql = "SELECT item, nececidad, sobrante FROM items_canal WHERE canal = " . $id;
    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operation)) {
            $items[] = $row;
        }
        return $items;
    }
}

function agregar_programacion_final($datos){
    include('../config.php');

    if ($datos["tipo"] == "RES") {
        $res = $datos["valor"];
        $cerdo = "";
    }else {
        $res = "";
        $cerdo = $datos["valor"];
    }

    $sql2 = "SELECT id FROM programacion_final WHERE sede = '$datos[sede]' AND semana = '$datos[semana]'";
    $rs_operation2 = mysqli_query($link, $sql2);
    if (mysqli_num_rows($rs_operation2) > 0) {
        if ($datos["tipo"] == "RES") {
            $sql = "UPDATE programacion_final SET res = '$datos[valor]' WHERE sede = '$datos[sede]' AND semana = '$datos[semana]'";
        }else {
            $sql = "UPDATE programacion_final SET cerdo = '$datos[valor]' WHERE sede = '$datos[sede]' AND semana = '$datos[semana]'";
        }
        
        $rs_operation = mysqli_query($link, $sql);

        if (!$rs_operation) {
            return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
        } else {
            return array("status" => "success", "sede" => $datos["sede"]);
        }
    }else {
        $sql = "INSERT INTO programacion_final(sede,semana,res,cerdo) 
            VALUES(
                '".$datos["sede"]."',
                '".$datos["semana"]."',
                '".$res."',
                '".$cerdo."'
            )";

        $rs_operation = mysqli_query($link, $sql);

        if (!$rs_operation) {
            return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
        } else {
            return array("status" => "success", "id" => mysqli_insert_id($link));
        }
    }
}

function traer_especies($semana){
    include('../config.php');

    $sql = "SELECT sede, res, cerdo FROM programacion_final WHERE semana = '$semana'";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operation)) {
            $items[] = $row;
        }
        return $items;
    }
}

function guardar_pesos_pollo($datos){
    include('../config.php');

    $sql= "INSERT INTO pesos_pollo(guia, tipo_pollo, kilos, cajas, cajas_base, nro_pollo) 
        VALUES(
            '".$datos["guia"]."',
            '".$datos["TipoPollo"]."',
            '".$datos["kilosP"]."',
            '".$datos["cajasP"]."',
            '".$datos["cajasBaseP"]."',
            '".$datos["nroPollos"]."'
        )";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}

function traer_pesos($id){
    include('../config.php');

    $sql = "SELECT 
        tipo_pollo,
        kilos,
        cajas,
        cajas_base,
        nro_pollo
        FROM pesos_pollo WHERE id = '$id'
    ";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operation)) {
            $items[] = $row;
        }
        return $items;
    }
}

function editar_pesos($datos){
    include('../config.php');

    $sql = "UPDATE pesos_pollo SET 
        tipo_pollo = '".$datos["tipoPollo"]."', 
        kilos = '".$datos["kilosP"]."', 
        cajas = '".$datos["cajasP"]."', 
        cajas_base = '".$datos["cajasBaseP"]."', 
        nro_pollo = '".$datos["nroPollos"]."' 
        WHERE id = '".$datos["id"]."'";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => $datos["id"]);
    }
}

function eliminarPeso($id){
    include('../config.php');

    $sql = "DELETE FROM pesos_pollo WHERE id = ". $id;

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return array("status" => "success", "id" => $id);
    }
}

function verificar_pollo($id){
    include('../config.php');

    $sql = "SELECT tipo_pollo FROM pesos_pollo WHERE guia = ". $id;
    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
    } else {
        if (mysqli_num_rows($rs_operation) > 0) {
            while ($row = mysqli_fetch_row($rs_operation)) {
                if ($row[0] == "ENTERO") {
                    $sql2 = "SELECT tipo_pollo FROM desprese WHERE id = ". $id;
                    $rs_operation2 = mysqli_query($link, $sql2);
                    $pollo = mysqli_fetch_row($rs_operation2);
                    return $pollo[0];
                }
            }
        }else {
            return "error";
        }
    }
}

function guardar_cambio($datos){
    include('../config.php');

    if (array_key_exists("status", $datos)) {
        $sql = "INSERT INTO registro_cambios(
            sede_origen,
            item,
            enviado,
            sede_destino,
            semana,
            especie,
            status
        ) 
        VALUES(
            '".$datos["sedeOrigen"]."',
            '".$datos["item"]."',
            '".$datos["cantidad"]."',
            '".$datos["sedeDestino"]."',
            '".$datos["semana"]."',
            '".$datos["especie"]."',
            '".$datos["status"]."'
        )";
    }else {
        $sql = "INSERT INTO registro_cambios(
            sede_origen,
            item,
            enviado,
            sede_destino,
            semana,
            especie
        ) 
        VALUES(
            '".$datos["sedeOrigen"]."',
            '".$datos["item"]."',
            '".$datos["cantidad"]."',
            '".$datos["sedeDestino"]."',
            '".$datos["semana"]."',
            '".$datos["especie"]."'
        )";
    }

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => mysqli_insert_id($link));
    }
}


function Borrar_Cambio($id) {
    include('../config.php');
    /* $sql2 = "SELECT enviado FROM registro_cambios WHERE id = $id";
    $rs_operation2 = mysqli_query($link, $sql2);
    $envido = mysqli_fetch_row($rs_operation2); */

    $sql = "DELETE FROM registro_cambios WHERE id = " . $id;
    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return array("status" => "successfully removed", "id" => $id);
    }
}

function ultimo_cambio(){
    include('../config.php');

    $sql = "SELECT * FROM registro_cambios ORDER BY id DESC LIMIT 1";
    $rs_operation = mysqli_query($link, $sql);
    $ultimo_cambio = mysqli_fetch_row($rs_operation);

    if (!$rs_operation) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
        exit();
    } else {
        return $ultimo_cambio;
    }
}

function verificar_campos($id){
    include('../config.php');

    $sql = "SELECT 
        proveedor_hielo,
        lote_hielo, 
        fecha_venci_hielo, 
        proveedor_empaque, 
        lote_empaque,
        fabricante_empaque,
        proveedor_salmuera,
        lote_salmuera,
        concentracion,
        fecha_venci_salmuera
        FROM desprese WHERE id = $id";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        echo "Error al ejecutar la consulta: " . mysqli_error($link);
    } else {
        $row = mysqli_fetch_row($rs_operation);
        if ($row[0] == "0" && $row[1] == "" && $row[2] == "0000-00-00" && $row[3] == "0" && $row[4] == "" && $row[5] == "0" && $row[6] == "0" && $row[7] == "" && $row[8] == "0" && $row[9] == "0000-00-00") {
            return true;
        } else {
            $items = [$row];
            return $items;
        }
    }
}

function agg_campos_guia($datos){
    include('../config.php');

    $sql = "UPDATE desprese SET 
        proveedor_hielo = '".$datos["proveedorH"]."',
        lote_hielo = '".$datos["loteHielo"]."',
        fecha_venci_hielo = '".$datos["fechaHielo"]."',
        proveedor_empaque = '".$datos["proveedorE"]."',
        lote_empaque = '".$datos["loteEmpaque"]."',
        fabricante_empaque = '".$datos["fabricanteEmpaque"]."',
        proveedor_salmuera = '".$datos["proveedorS"]."',
        lote_salmuera = '".$datos["loteSalmuera"]."',
        fecha_venci_salmuera = '".$datos["fechaSalmuera"]."',
        concentracion = '".$datos["concentracion"]."'
        WHERE id = '".$datos["idGuia"]."'
    ";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "id" => $datos["idGuia"]);
    }
}

function verificar_items($id){
    include('../config.php');

    $sql = "SELECT id FROM mejora_items WHERE 
        id_guia = $id AND item = '059761' OR 
        id_guia = $id AND item = '059760' OR 
        id_guia = $id AND item = '059762'
        GROUP BY item
    ";

    $rs_operation = mysqli_query($link, $sql);

    $sql2 = "SELECT id FROM mejora_items WHERE 
        id_guia = $id AND item = '059758' OR 
        id_guia = $id AND item = '059756' OR 
        id_guia = $id AND item = '059757'
        GROUP BY item
    ";

    $rs_operation2 = mysqli_query($link, $sql2);

    $sql3 = "SELECT Temp1, Temp2, Temp3 FROM desprese WHERE id = $id";
    $rs_operation3 = mysqli_query($link, $sql3);
    $Temps = mysqli_fetch_row($rs_operation3);

    if (!$rs_operation || !$rs_operation2) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        if ($Temps[0] == "" || $Temps[1] == "" || $Temps[2] == "") {
            if (mysqli_num_rows($rs_operation) == 3 || mysqli_num_rows($rs_operation2) == 3) {
                return array("status" => "success");
            }else {
                return array("status" => "error", "message" => "No se han registrado los items necesarios");
            }
        }else {
            return "Temperaturas registradas";
        }
    }
    
}

function mostrar_alerta(){
    include('../config.php');

    $sql = "SELECT 
        Temp1,
        Temp2,
        Temp3,
        destinos.sede AS sede
        FROM desprese 
        INNER JOIN destinos ON desprese.destino = destinos.id
        ORDER BY desprese.id DESC
    ";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        while ($row = mysqli_fetch_row($rs_operation)) {
            if ($row[0] == "" || $row[1] == "" || $row[2] == "") {
                return array("status" => "success", "sede" => trim($row[3]) , "message" => "No se han registrado las temperaturas");
            }
        }
        return array("status" => "success", "sede" => "", "message" => "Todas las sedes tienen temperaturas registradas");
    }
    
}

function verificar_Pesos_Desprese($id){
    include('../config.php');

    $sql = "SELECT item, SUM(kilos), SUM(cajas), SUM(canastilla_base) FROM desprese_items WHERE 
        guia = '$id' AND item = '059758' OR
        guia = '$id' AND item = '059757' OR
        guia = '$id' AND item = '059756' OR
        guia = '$id' AND item = '059762' OR
        guia = '$id' AND item = '059761' OR
        guia = '$id' AND item = '059760'
        GROUP BY item
    ";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        if (mysqli_num_rows($rs_operation) >= 3) {
            $sql2 = "SELECT SUM(kilos), SUM(cajas), SUM(cajas_base) FROM pesos_pollo WHERE guia = '$id' AND tipo_pollo = 'DESPRESE' GROUP BY tipo_pollo";
            $rs_operation2 = mysqli_query($link, $sql2);
            if (!$rs_operation2) {
                return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
            } else {
                if (mysqli_num_rows($rs_operation2) > 0) {
                    $items = ["kilos" => 0];
                    while ($row = mysqli_fetch_row($rs_operation)) {
                        $items["kilos"] += $row[1] - (($row[2] * 2) + ($row[3] * 1.8));
                    }
                    $pollo = mysqli_fetch_row($rs_operation2);
                    $pollo = $pollo[0] - (($pollo[1] * 2) + ($pollo[2] * 1.8));
                    $porcentaje = ($pollo - $items["kilos"]) / $pollo * 100;
                    if ($porcentaje >= 0 && $porcentaje <= 2) {
                        return array("status" => "success", "message" => "El peso de los items est dentro del rango de aceptacin");
                    } elseif ($porcentaje < 0) {
                        return array("status" => "errorM", "message" => "El peso de los items est por encima del peso de los pollos", "porcentaje" => $porcentaje);
                    } else {
                        return array("status" => "errorA", "message" => "El peso de los items est por debajo del peso de los pollos", "porcentaje" => $porcentaje);
                    }
                    
                } else {
                    return array("status" => "error", "message" => "No se hay registros de pollo desprese");
                }
            }
        }else {
            return array("status" => "error", "message" => "No se han encontrado los pesos necesarios para la guia $id");
        }
    }
    
}

function verificar_proveedor_orden($datos) {
    include('../config.php');

    $sql = "SELECT id_recepcion FROM recepcionpollo WHERE fecharec = '$datos[fecha]' AND beneficio = '$datos[proveedor]'";
    $rs_operation = mysqli_query($link, $sql);

    $sql2 = "SELECT siglas FROM proveedorpollo WHERE id = '$datos[proveedor]'";
    $rs_operation2 = mysqli_query($link, $sql2);

    if (!$rs_operation || !$rs_operation2) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        $items = [];
        $letras = ["A", "B", "C", "D", "E"];
        if (mysqli_num_rows($rs_operation) > 0) {
            $items["orden"] = $letras[mysqli_num_rows($rs_operation)];
        }else {
            $items["orden"] = "A";
        }
        $items["proveedor"] = mysqli_fetch_row($rs_operation2)[0];
        return $items;
    }
    
}

function borrar_lote($id){
    include('../config.php');

    $sql = "DELETE FROM lotes_guia WHERE id = '$id'";
    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "message" => "Lote eliminado con xito");
    }
}

function guardar_lote($datos) {
    include('../config.php');

    $sql = "INSERT INTO lotes_guia(
        recepcion_guia, 
        lote
    ) VALUES (
        '".$datos["idGuia"]."',
        '".$datos["lote"]."'
    )";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta: " . mysqli_error($link));
    } else {
        return array("status" => "success", "message" => "Lote guardado con xito", "id" => mysqli_insert_id($link));
    }
    
}

function intercambio_res($semana) {
    include('../config.php');

    $sql = "SELECT 
        items_canal.sede,
        item, 
        nececidad, 
        items_canal.id AS id_item
        FROM items_canal
        INNER JOIN
            programacioncanales ON items_canal.canal = programacioncanales.id
        WHERE programacioncanales.semana = '$semana' AND programacioncanales.especie = 'RES' AND sobrante = ''
    ";
    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta de las necesidades de Res: " . mysqli_error($link));
    }

    $nececidad = array();

    while ($row = mysqli_fetch_row($rs_operation)) {
        $nececidad[$row[0]][$row[1]][] = $row[2];
    }

    $sql2 = "SELECT 
        items_canal.sede,
        item, 
        sobrante, 
        items_canal.id AS id_item
        FROM items_canal 
        INNER JOIN
            programacioncanales ON items_canal.canal = programacioncanales.id
        WHERE programacioncanales.semana = '$semana' AND programacioncanales.especie = 'RES' AND nececidad = ''
    ";
    $rs_operation2 = mysqli_query($link, $sql2);

    if (!$rs_operation2) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta de los sobrantes de Res: " . mysqli_error($link));
    }

    $sobrante = array();

    while ($row2 = mysqli_fetch_row($rs_operation2)) {
        $sobrante[$row2[0]][$row2[1]][] = $row2[2];
    }

    $sql4 = "SELECT sede_origen, item, enviado, sede_destino FROM registro_cambios WHERE semana = '$semana' AND especie = 'RES' AND status = '0'";
    $rs_operation4 = mysqli_query($link, $sql4);

    while ($row4 = mysqli_fetch_row($rs_operation4)) {
        if (isset($nececidad[$row4[3]][$row4[1]])) {
            $nececidad[$row4[3]][$row4[1]][0] -= $row4[2];
        }
        if (isset($sobrante[$row4[0]][$row4[1]])) {
            $sobrante[$row4[0]][$row4[1]][0] -= $row4[2];
        }
    }

    $sedesA = ["LA 5A", "LA 39", "PLAZA NORTE", "CIUDAD JARDIN", "CENTRO SUR", "PALMIRA", "FLORESTA", "FLORALIA", "GUADUALES", "BOGOTA LA 80", "BOGOTA CHIA"];

    $mercatodo = ["FLORESTA", "FLORALIA", "GUADUALES"];
    $mercamio = ["LA 5A", "LA 39", "PLAZA NORTE", "CIUDAD JARDIN", "CENTRO SUR", "PALMIRA"];
    $merkmios = ["BOGOTA LA 80", "BOGOTA CHIA"];

    $NroItems = ["073617", "073618", "073619", "073620", "073624", "073625", "073626", "073627", "073628", "073631", "006411", "037508", "073633", "073621", "073622", "073623", "073629", "073630"];

    /* $Items = [
        "073617" => "AMPOLLETA NORMAL", 
        "073618" => "BOLA NEGRA NORMAL",
        "073619" => "CADERITA NORMA",
        "073620" => "COSTILLA NORMAL",
        "073624" => "MORRILLO*KILO",
        "073625" => "MUCHACHO",
        "073626" => "PECHO*KILO",
        "073627" => "PEPINO*KILO",
        "073628" => "PULPA NORMAL",
        "073631" => "SOBACO*KILO",
        "006411" => "HUESO COGOTE",
        "037508" => "HUESO PROMOCION",
        "073633" => "LOMO VICHE",
        "073621" => "ESPALDILLA",
        "073622" => "LOMO CARACHA",
        "073623" => "LOMO REDONDO",
        "073629" => "PUNTA ANCA",
        "073630" => "PUNTA FALDA"
    ]; */

    $cont = 0;
    /* $registro = array(); */

    for ($i=0; $i < 11 ; $i++) {
        if (array_key_exists($sedesA[$i], $nececidad)) {
            for ($j=0; $j < 18 ; $j++) { 
                if (array_key_exists($NroItems[$j], $nececidad[$sedesA[$i]])) {
                    $cantidadNecesidad = $nececidad[$sedesA[$i]][$NroItems[$j]][0];
                    for ($a=0; $a < 11; $a++) {
                        if ($cantidadNecesidad > 0) {
                            if (array_key_exists($sedesA[$a], $sobrante)) {
                                if (in_array($sedesA[$i], $mercatodo) && in_array($sedesA[$a], $mercatodo) || in_array($sedesA[$i], $mercamio) && in_array($sedesA[$a], $mercamio) || in_array($sedesA[$i], $merkmios) && in_array($sedesA[$a], $merkmios)) {
                                    if (array_key_exists($NroItems[$j], $sobrante[$sedesA[$a]])) {
                                        if ($sobrante[$sedesA[$a]][$NroItems[$j]][0] != '') {
                                            if ($sobrante[$sedesA[$a]][$NroItems[$j]][0] <= $cantidadNecesidad) {
                                                $datos = [
                                                    "sedeOrigen" => $sedesA[$a],
                                                    "item" => $NroItems[$j],
                                                    "cantidad" => $sobrante[$sedesA[$a]][$NroItems[$j]][0],
                                                    "sedeDestino" => $sedesA[$i],
                                                    "semana" => $semana,
                                                    "especie" => "RES",
                                                    "status" => 1
                                                ];
                                                $sql3 = "SELECT id FROM registro_cambios WHERE 
                                                    sede_origen = '".$sedesA[$a]."' AND
                                                    item = '".$NroItems[$j]."' AND
                                                    enviado = '".$sobrante[$sedesA[$a]][$NroItems[$j]][0]."' AND
                                                    sede_destino = '".$sedesA[$i]."' AND
                                                    semana = '".$semana."' AND
                                                    especie = 'RES'
                                                ";
                                                $rs_operation3 = mysqli_query($link, $sql3);
                                                if (!$rs_operation3) {
                                                    return array("status" => "error", "message" => "Error al ejecutar la consulta de los registros de cambios: " . mysqli_error($link));
                                                } else {
                                                    if (mysqli_num_rows($rs_operation3) == 0) {
                                                        $resultado = guardar_cambio($datos);
                                                        if ($resultado["status"] == "success") {
                                                            $cont++;
                                                            /* $registro[$cont] = [
                                                                "sedeOrigen" => $sedesA[$a],
                                                                "item" => $Items[$NroItems[$j]],
                                                                "cantidad" => $sobrante[$sedesA[$a]][$NroItems[$j]][0],
                                                                "sedeDestino" => $sedesA[$i],
                                                                "semana" => $semana,
                                                                "especie" => "RES"
                                                            ]; */
                                                        }
                                                    }
                                                }
                                                $cantidadNecesidad -= $sobrante[$sedesA[$a]][$NroItems[$j]][0];
                                                $sobrante[$sedesA[$a]][$NroItems[$j]][0] = "";
                                            }else {
                                                $datos = [
                                                    "sedeOrigen" => $sedesA[$a],
                                                    "item" => $NroItems[$j],
                                                    "cantidad" => $cantidadNecesidad,
                                                    "sedeDestino" => $sedesA[$i],
                                                    "semana" => $semana,
                                                    "especie" => "RES",
                                                    "status" => 1
                                                ];
                                                $sql3 = "SELECT id FROM registro_cambios WHERE 
                                                    sede_origen = '".$sedesA[$a]."' AND
                                                    item = '".$NroItems[$j]."' AND
                                                    enviado = '".$cantidadNecesidad."' AND
                                                    sede_destino = '".$sedesA[$i]."' AND
                                                    semana = '".$semana."' AND
                                                    especie = 'RES'
                                                ";
                                                $rs_operation3 = mysqli_query($link, $sql3);
                                                if (!$rs_operation3) {
                                                    return array("status" => "error", "message" => "Error al ejecutar la consulta de los registros de cambios: " . mysqli_error($link));
                                                } else {
                                                    if (mysqli_num_rows($rs_operation3) == 0) {
                                                        $resultado = guardar_cambio($datos);
                                                        if ($resultado["status"] == "success") {
                                                            $cont++;
                                                            /* $registro[$cont] = [
                                                                "sedeOrigen" => $sedesA[$a],
                                                                "item" => $Items[$NroItems[$j]],
                                                                "cantidad" => $cantidadNecesidad,
                                                                "sedeDestino" => $sedesA[$i],
                                                                "semana" => $semana,
                                                                "especie" => "RES"
                                                            ]; */
                                                        }
                                                    }
                                                }
                                                $sobrante[$sedesA[$a]][$NroItems[$j]][0] -= $cantidadNecesidad;
                                                $cantidadNecesidad = 0;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    return array("status" => "success", "message" => "Se han realizado $cont cambios");
}

function intercambio_cerdo($semana) {
    include('../config.php');

    $sql = "SELECT 
        items_canal.sede,
        item, 
        nececidad, 
        items_canal.id AS id_item
        FROM items_canal
        INNER JOIN
            programacioncanales ON items_canal.canal = programacioncanales.id
        WHERE programacioncanales.semana = '$semana' AND programacioncanales.especie = 'CERDO' AND sobrante = ''
    ";
    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta de las necesidades de Res: " . mysqli_error($link));
    }

    $nececidad = array();

    while ($row = mysqli_fetch_row($rs_operation)) {
        $nececidad[$row[0]][$row[1]][] = $row[2];
    }

    $sql2 = "SELECT 
        items_canal.sede,
        item, 
        sobrante, 
        items_canal.id AS id_item
        FROM items_canal 
        INNER JOIN
            programacioncanales ON items_canal.canal = programacioncanales.id
        WHERE programacioncanales.semana = '$semana' AND programacioncanales.especie = 'CERDO' AND nececidad = ''
    ";
    $rs_operation2 = mysqli_query($link, $sql2);

    if (!$rs_operation2) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta de los sobrantes de Res: " . mysqli_error($link));
    }

    $sobrante = array();

    while ($row2 = mysqli_fetch_row($rs_operation2)) {
        $sobrante[$row2[0]][$row2[1]][] = $row2[2];
    }

    $sql4 = "SELECT sede_origen, item, enviado, sede_destino FROM registro_cambios WHERE semana = '$semana' AND especie = 'CERDO' AND status = '0'";
    $rs_operation4 = mysqli_query($link, $sql4);

    while ($row4 = mysqli_fetch_row($rs_operation4)) {
        if (isset($nececidad[$row4[3]][$row4[1]])) {
            $nececidad[$row4[3]][$row4[1]][0] -= $row4[2];
        }
        if (isset($sobrante[$row4[0]][$row4[1]])) {
            $sobrante[$row4[0]][$row4[1]][0] -= $row4[2];
        }
    }

    $sedesA = ["LA 5A", "LA 39", "PLAZA NORTE", "CIUDAD JARDIN", "CENTRO SUR", "PALMIRA", "FLORESTA", "FLORALIA", "GUADUALES", "BOGOTA LA 80", "BOGOTA CHIA"];

    $mercatodo = ["FLORESTA", "FLORALIA", "GUADUALES"];
    $mercamio = ["LA 5A", "LA 39", "PLAZA NORTE", "CIUDAD JARDIN", "CENTRO SUR", "PALMIRA"];
    $merkmios = ["BOGOTA LA 80", "BOGOTA CHIA"];

    $NroItems = ["073612", "073613", "073614", "073615", "073616", "009251", "073559", "005800", "009270", "005819", "007844", "040959", "033700"];

    /* $Items = [
        "073612" => "BRAZO CERDO", 
        "073613" => "COSTILLA CERDO", 
        "073614" => "LOMO CERDO", 
        "073615" => "PERNIL CERDO", 
        "073616" => "TOCINETA", 
        "009251" => "ESPINAZO", 
        "073559" => "HUESO BLANCO CERDO", 
        "005800" => "EMPELLLA CERDO", 
        "009270" => "OREJA CERDO", 
        "005819" => "PAPADA", 
        "007844" => "PEZUNA", 
        "040959" => "TOCINO", 
        "033700" => "CABEZA SIN OREJA"
    ]; */

    $cont = 0;
    /* $registro = array(); */

    for ($i=0; $i < 11 ; $i++) {
        if (array_key_exists($sedesA[$i], $nececidad)) {
            for ($j=0; $j < 13 ; $j++) { 
                if (array_key_exists($NroItems[$j], $nececidad[$sedesA[$i]])) {
                    $cantidadNecesidad = $nececidad[$sedesA[$i]][$NroItems[$j]][0];
                    for ($a=0; $a < 11; $a++) {
                        if ($cantidadNecesidad > 0) {
                            if (array_key_exists($sedesA[$a], $sobrante)) {
                                if (in_array($sedesA[$i], $mercatodo) && in_array($sedesA[$a], $mercatodo) || in_array($sedesA[$i], $mercamio) && in_array($sedesA[$a], $mercamio) || in_array($sedesA[$i], $merkmios) && in_array($sedesA[$a], $merkmios)) {
                                    if (array_key_exists($NroItems[$j], $sobrante[$sedesA[$a]])) {
                                        if ($sobrante[$sedesA[$a]][$NroItems[$j]][0] != '') {
                                            if ($sobrante[$sedesA[$a]][$NroItems[$j]][0] <= $cantidadNecesidad) {
                                                $datos = [
                                                    "sedeOrigen" => $sedesA[$a],
                                                    "item" => $NroItems[$j],
                                                    "cantidad" => $sobrante[$sedesA[$a]][$NroItems[$j]][0],
                                                    "sedeDestino" => $sedesA[$i],
                                                    "semana" => $semana,
                                                    "especie" => "CERDO",
                                                    "status" => 1
                                                ];
                                                $sql3 = "SELECT id FROM registro_cambios WHERE 
                                                    sede_origen = '".$sedesA[$a]."' AND
                                                    item = '".$NroItems[$j]."' AND
                                                    enviado = '".$sobrante[$sedesA[$a]][$NroItems[$j]][0]."' AND
                                                    sede_destino = '".$sedesA[$i]."' AND
                                                    semana = '".$semana."' AND
                                                    especie = 'CERDO'
                                                ";
                                                $rs_operation3 = mysqli_query($link, $sql3);
                                                if (!$rs_operation3) {
                                                    return array("status" => "error", "message" => "Error al ejecutar la consulta de los registros de cambios: " . mysqli_error($link));
                                                } else {
                                                    if (mysqli_num_rows($rs_operation3) == 0) {
                                                        $resultado = guardar_cambio($datos);
                                                        if ($resultado["status"] == "success") {
                                                            $cont++;
                                                            /* $registro[$cont] = [
                                                                "sedeOrigen" => $sedesA[$a],
                                                                "item" => $Items[$NroItems[$j]],
                                                                "cantidad" => $sobrante[$sedesA[$a]][$NroItems[$j]][0],
                                                                "sedeDestino" => $sedesA[$i],
                                                                "semana" => $semana,
                                                                "especie" => "CERDO"
                                                            ]; */
                                                        }
                                                    }
                                                }
                                                $cantidadNecesidad -= $sobrante[$sedesA[$a]][$NroItems[$j]][0];
                                                $sobrante[$sedesA[$a]][$NroItems[$j]][0] = "";
                                            }else {
                                                $datos = [
                                                    "sedeOrigen" => $sedesA[$a],
                                                    "item" => $NroItems[$j],
                                                    "cantidad" => $cantidadNecesidad,
                                                    "sedeDestino" => $sedesA[$i],
                                                    "semana" => $semana,
                                                    "especie" => "CERDO",
                                                    "status" => 1
                                                ];
                                                $sql3 = "SELECT id FROM registro_cambios WHERE 
                                                    sede_origen = '".$sedesA[$a]."' AND
                                                    item = '".$NroItems[$j]."' AND
                                                    enviado = '".$cantidadNecesidad."' AND
                                                    sede_destino = '".$sedesA[$i]."' AND
                                                    semana = '".$semana."' AND
                                                    especie = 'CERDO'
                                                ";
                                                $rs_operation3 = mysqli_query($link, $sql3);
                                                if (!$rs_operation3) {
                                                    return array("status" => "error", "message" => "Error al ejecutar la consulta de los registros de cambios: " . mysqli_error($link));
                                                } else {
                                                    if (mysqli_num_rows($rs_operation3) == 0) {
                                                        $resultado = guardar_cambio($datos);
                                                        if ($resultado["status"] == "success") {
                                                            $cont++;
                                                            /* $registro[$cont] = [
                                                                "sedeOrigen" => $sedesA[$a],
                                                                "item" => $Items[$NroItems[$j]],
                                                                "cantidad" => $cantidadNecesidad,
                                                                "sedeDestino" => $sedesA[$i],
                                                                "semana" => $semana,
                                                                "especie" => "CERDO"
                                                            ]; */
                                                        }
                                                    }
                                                }
                                                $sobrante[$sedesA[$a]][$NroItems[$j]][0] -= $cantidadNecesidad;
                                                $cantidadNecesidad = 0;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    return array("status" => "success", "message" => "Se han realizado $cont cambios");
}

function revertir_res($semana){
    include('../config.php');

    $NroItems = ["073617", "073618", "073619", "073620", "073624", "073625", "073626", "073627", "073628", "073631", "006411", "037508", "073633", "073621", "073622", "073623", "073629", "073630"];

    $NroItems = "'" . implode("','", $NroItems) . "'";

    $sql = "DELETE FROM registro_cambios WHERE semana = '$semana' AND status = '1' AND item IN ($NroItems)";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta de los registros de cambios: " . mysqli_error($link));
    } else {
        return array("status" => "success", "message" => "Se han revertido los registros de cambios de la semana $semana en la RES");
    }
}

function revertir_cerdo($semana){
    include('../config.php');

    $NroItems = ["073612", "073613", "073614", "073615", "073616", "009251", "073559", "005800", "009270", "005819", "007844", "040959", "033700"];

    $NroItems = "'" . implode("','", $NroItems) . "'";

    $sql = "DELETE FROM registro_cambios WHERE semana = '$semana' AND status = '1' AND item IN ($NroItems)";

    $rs_operation = mysqli_query($link, $sql);

    if (!$rs_operation) {
        return array("status" => "error", "message" => "Error al ejecutar la consulta de los registros de cambios: " . mysqli_error($link));
    } else {
        return array("status" => "success", "message" => "Se han revertido los registros de cambios de la semana $semana en los CERDOS");
    }
}

function listaProveedoresCerdo(){
    include('./config.php');
    $sql = "SELECT id, sede FROM proveedor_cerdo WHERE status = 'ACTIVO'";

    $rs_operacion = mysqli_query($link, $sql);

    if (!$rs_operacion) {
        echo "Error al ejecutar la consulta salmuera: " . mysqli_error($link);
        exit();
    } else {
        $items = [];
        while ($row = mysqli_fetch_row($rs_operacion)) {
            $items[] = $row;
        }
        return $items;
    }

}